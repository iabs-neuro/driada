============================= test session starts ==============================
platform darwin -- Python 3.10.18, pytest-8.4.1, pluggy-1.6.0 -- /opt/anaconda3/envs/driada/bin/python
cachedir: .pytest_cache
rootdir: /Users/nikita/PycharmProjects/driada2
configfile: pytest.ini
plugins: timeout-2.4.0, cov-6.2.1
collecting ... collected 148 items

tests/unit/experiment/test_duplicate_behavior.py::test_duplicate_behavior_ignore PASSED [  0%]
tests/unit/experiment/test_duplicate_behavior.py::test_duplicate_behavior_warn PASSED [  1%]
tests/unit/experiment/test_duplicate_behavior.py::test_duplicate_behavior_raise PASSED [  2%]
tests/unit/experiment/test_duplicate_behavior.py::test_duplicate_behavior_in_pipelines FAILED [  2%]
tests/unit/experiment/test_duplicate_behavior.py::test_no_duplicates_all_behaviors PASSED [  3%]
tests/unit/experiment/test_spike_reconstruction.py::test_events_to_ts_array_basic PASSED [  4%]
tests/unit/experiment/test_spike_reconstruction.py::test_events_to_ts_array_multiple_neurons PASSED [  4%]
tests/unit/experiment/test_spike_reconstruction.py::test_events_to_ts_array_edge_cases PASSED [  5%]
tests/unit/experiment/test_spike_reconstruction.py::test_wavelet_spike_reconstruction PASSED [  6%]
tests/unit/experiment/test_spike_reconstruction.py::test_experiment_with_spike_reconstruction PASSED [  6%]
tests/unit/experiment/test_spike_reconstruction.py::test_spike_reconstruction_reproducibility PASSED [  7%]
tests/unit/experiment/test_spike_reconstruction_refactor.py::test_reconstruct_spikes_wavelet_method PASSED [  8%]
tests/unit/experiment/test_spike_reconstruction_refactor.py::test_reconstruct_spikes_threshold_method PASSED [  8%]
tests/unit/experiment/test_spike_reconstruction_refactor.py::test_reconstruct_spikes_custom_method FAILED [  9%]
tests/unit/experiment/test_spike_reconstruction_refactor.py::test_reconstruct_spikes_invalid_method PASSED [ 10%]
tests/unit/experiment/test_spike_reconstruction_refactor.py::test_wavelet_vs_threshold_comparison PASSED [ 10%]
tests/unit/experiment/test_spike_reconstruction_refactor.py::test_experiment_integration PASSED [ 11%]
tests/unit/experiment/test_spike_reconstruction_refactor.py::test_parameter_propagation PASSED [ 12%]
tests/unit/experiment/test_neuron.py::TestNeuronInitialization::test_init_basic PASSED [ 12%]
tests/unit/experiment/test_neuron.py::TestNeuronInitialization::test_init_without_spikes PASSED [ 13%]
tests/unit/experiment/test_neuron.py::TestNeuronInitialization::test_init_with_negative_calcium PASSED [ 14%]
tests/unit/experiment/test_neuron.py::TestNeuronInitialization::test_init_with_custom_parameters PASSED [ 14%]
tests/unit/experiment/test_neuron.py::TestNeuronInitialization::test_shuffle_mask_creation PASSED [ 15%]
tests/unit/experiment/test_neuron.py::TestNeuronInitialization::test_fit_individual_t_off PASSED [ 16%]
tests/unit/experiment/test_neuron.py::TestNeuronStaticMethods::test_spike_form PASSED [ 16%]
tests/unit/experiment/test_neuron.py::TestNeuronStaticMethods::test_get_restored_calcium PASSED [ 17%]
tests/unit/experiment/test_neuron.py::TestNeuronStaticMethods::test_calcium_preprocessing PASSED [ 18%]
tests/unit/experiment/test_neuron.py::TestNeuronMethods::test_reconstruct_spikes_not_implemented PASSED [ 18%]
tests/unit/experiment/test_neuron.py::TestNeuronMethods::test_get_mad PASSED [ 19%]
tests/unit/experiment/test_neuron.py::TestNeuronMethods::test_get_snr_with_spikes PASSED [ 20%]
tests/unit/experiment/test_neuron.py::TestNeuronMethods::test_get_snr_without_spikes PASSED [ 20%]
tests/unit/experiment/test_neuron.py::TestNeuronMethods::test_calc_snr_nan_handling FAILED [ 21%]
tests/unit/experiment/test_neuron.py::TestNeuronMethods::test_fit_t_off PASSED [ 22%]
tests/unit/experiment/test_neuron.py::TestNeuronMethods::test_get_t_off_caching PASSED [ 22%]
tests/unit/experiment/test_neuron.py::TestNeuronMethods::test_get_noise_ampl_caching PASSED [ 23%]
tests/unit/experiment/test_neuron.py::TestNeuronMethods::test_fit_t_off_high_value_warning PASSED [ 24%]
tests/unit/experiment/test_neuron.py::TestCalciumShuffling::test_shuffle_calcium_roll_based PASSED [ 25%]
tests/unit/experiment/test_neuron.py::TestCalciumShuffling::test_shuffle_calcium_roll_based_with_shift PASSED [ 25%]
tests/unit/experiment/test_neuron.py::TestCalciumShuffling::test_shuffle_calcium_chunks_based PASSED [ 26%]
tests/unit/experiment/test_neuron.py::TestCalciumShuffling::test_shuffle_calcium_waveform_based PASSED [ 27%]
tests/unit/experiment/test_neuron.py::TestCalciumShuffling::test_shuffle_calcium_return_timeseries PASSED [ 27%]
tests/unit/experiment/test_neuron.py::TestCalciumShuffling::test_shuffle_calcium_unknown_method PASSED [ 28%]
tests/unit/experiment/test_neuron.py::TestSpikeShuffling::test_shuffle_spikes_no_spike_data PASSED [ 29%]
tests/unit/experiment/test_neuron.py::TestSpikeShuffling::test_shuffle_spikes_isi_based PASSED [ 29%]
tests/unit/experiment/test_neuron.py::TestSpikeShuffling::test_shuffle_spikes_isi_based_no_events PASSED [ 30%]
tests/unit/experiment/test_neuron.py::TestSpikeShuffling::test_shuffle_spikes_isi_based_multi_valued PASSED [ 31%]
tests/unit/experiment/test_neuron.py::TestSpikeShuffling::test_shuffle_spikes_return_timeseries PASSED [ 31%]
tests/unit/experiment/test_neuron.py::TestSpikeShuffling::test_shuffle_spikes_unknown_method PASSED [ 32%]
tests/unit/experiment/test_neuron.py::TestIntegration::test_wavelet_spike_inference PASSED [ 33%]
tests/unit/experiment/test_neuron.py::TestIntegration::test_neuron_with_experiment_compatibility PASSED [ 33%]
tests/unit/experiment/test_wavelet_imports.py::TestWaveletModuleImports::test_import_wavelet_ridge PASSED [ 34%]
tests/unit/experiment/test_wavelet_imports.py::TestWaveletModuleImports::test_import_wavelet_event_detection PASSED [ 35%]
tests/unit/experiment/test_wavelet_imports.py::TestWaveletModuleImports::test_wavelet_modules_have_functions PASSED [ 35%]
tests/unit/experiment/test_exp.py::test_creation PASSED                  [ 36%]
tests/unit/experiment/test_exp.py::test_intense_exp FAILED               [ 37%]
tests/unit/experiment/test_calcium_dynamics.py::test_validate_peak_rate PASSED [ 37%]
tests/unit/experiment/test_calcium_dynamics.py::test_circular_manifold_defaults PASSED [ 38%]
tests/unit/experiment/test_calcium_dynamics.py::test_2d_manifold_defaults PASSED [ 39%]
tests/unit/experiment/test_calcium_dynamics.py::test_3d_manifold_defaults PASSED [ 39%]
tests/unit/experiment/test_calcium_dynamics.py::test_mixed_population_defaults PASSED [ 40%]
tests/unit/experiment/test_calcium_dynamics.py::test_calcium_saturation_effect PASSED [ 41%]
tests/unit/experiment/test_calcium_dynamics.py::test_parameter_documentation PASSED [ 41%]
tests/unit/experiment/test_calcium_dynamics.py::test_default_values_are_realistic PASSED [ 42%]
tests/unit/experiment/test_exp_base.py::TestDynamicFeatureValidation::test_check_dynamic_features_empty PASSED [ 43%]
tests/unit/experiment/test_exp_base.py::TestDynamicFeatureValidation::test_check_dynamic_features_valid_timeseries PASSED [ 43%]
tests/unit/experiment/test_exp_base.py::TestDynamicFeatureValidation::test_check_dynamic_features_valid_arrays PASSED [ 44%]
tests/unit/experiment/test_exp_base.py::TestDynamicFeatureValidation::test_check_dynamic_features_valid_multitimeseries PASSED [ 45%]
tests/unit/experiment/test_exp_base.py::TestDynamicFeatureValidation::test_check_dynamic_features_mismatched_lengths PASSED [ 45%]
tests/unit/experiment/test_exp_base.py::TestDynamicFeatureValidation::test_check_dynamic_features_2d_arrays PASSED [ 46%]
tests/unit/experiment/test_exp_base.py::TestDynamicFeatureValidation::test_check_dynamic_features_mixed_types PASSED [ 47%]
tests/unit/experiment/test_exp_base.py::TestDynamicFeatureValidation::test_check_dynamic_features_unsupported_type PASSED [ 47%]
tests/unit/experiment/test_exp_base.py::TestExperimentInitialization::test_init_no_calcium_data PASSED [ 48%]
tests/unit/experiment/test_exp_base.py::TestExperimentInitialization::test_init_minimal_valid PASSED [ 49%]
tests/unit/experiment/test_exp_base.py::TestExperimentInitialization::test_init_with_spikes PASSED [ 50%]
tests/unit/experiment/test_exp_base.py::TestExperimentInitialization::test_init_with_spike_reconstruction PASSED [ 50%]
tests/unit/experiment/test_exp_base.py::TestExperimentInitialization::test_init_with_bad_frames_mask PASSED [ 51%]
tests/unit/experiment/test_exp_base.py::TestExperimentInitialization::test_init_dynamic_feature_conversion PASSED [ 52%]
tests/unit/experiment/test_exp_base.py::TestExperimentInitialization::test_init_exp_identificators PASSED [ 52%]
tests/unit/experiment/test_exp_base.py::TestExperimentInitialization::test_checkpoint_transposed_data PASSED [ 53%]
tests/unit/experiment/test_exp_base.py::TestExperimentInitialization::test_checkpoint_feature_shape_mismatch PASSED [ 54%]
tests/unit/experiment/test_exp_base.py::TestExperimentInitialization::test_feature_attribute_conflict PASSED [ 54%]
tests/unit/experiment/test_exp_base.py::TestExperimentInitialization::test_static_feature_conflict PASSED [ 55%]
tests/unit/experiment/test_exp_base.py::TestExperimentInitialization::test_init_with_3d_feature PASSED [ 56%]
tests/unit/experiment/test_exp_base.py::TestExperimentMethods::test_check_ds PASSED [ 56%]
tests/unit/experiment/test_exp_base.py::TestExperimentMethods::test_process_cbunch PASSED [ 57%]
tests/unit/experiment/test_exp_base.py::TestExperimentMethods::test_process_fbunch PASSED [ 58%]
tests/unit/experiment/test_exp_base.py::TestExperimentMethods::test_process_fbunch_multifeatures PASSED [ 58%]
tests/unit/experiment/test_exp_base.py::TestExperimentMethods::test_process_sbunch PASSED [ 59%]
tests/unit/experiment/test_exp_base.py::TestExperimentMethods::test_build_pair_hash PASSED [ 60%]
tests/unit/experiment/test_exp_base.py::TestExperimentMethods::test_get_feature_entropy PASSED [ 60%]
tests/unit/experiment/test_exp_base.py::TestExperimentMethods::test_stats_table_initialization PASSED [ 61%]
tests/unit/experiment/test_exp_base.py::TestExperimentMethods::test_hash_methods PASSED [ 62%]
tests/unit/experiment/test_exp_base.py::TestExperimentMethods::test_spikes_detection PASSED [ 62%]
tests/unit/experiment/test_exp_base.py::TestExperimentMethods::test_trim_data_with_bad_frames PASSED [ 63%]
tests/unit/experiment/test_exp_base.py::TestExperimentMethods::test_data_hashes PASSED [ 64%]
tests/unit/experiment/test_exp_base.py::TestExperimentMethods::test_multicell_shuffled_data PASSED [ 64%]
tests/unit/experiment/test_exp_base.py::TestExperimentMethods::test_neuron_list_creation PASSED [ 65%]
tests/unit/experiment/test_exp_base.py::TestExperimentMethods::test_set_selectivity_tables PASSED [ 66%]
tests/unit/experiment/test_exp_base.py::TestExperimentMethods::test_update_neuron_feature_pair_stats PASSED [ 66%]
tests/unit/experiment/test_exp_base.py::TestExperimentMethods::test_get_stats_slice PASSED [ 67%]
tests/unit/experiment/test_exp_base.py::TestExperimentMethods::test_get_feature_entropy_multitimeseries PASSED [ 68%]
tests/unit/experiment/test_exp_base.py::TestExperimentMethods::test_get_feature_entropy_errors PASSED [ 68%]
tests/unit/experiment/test_exp_base.py::TestExperimentMethods::test_store_and_get_embedding PASSED [ 69%]
tests/unit/experiment/test_exp_base.py::TestExperimentMethods::test_get_significant_neurons PASSED [ 70%]
tests/unit/experiment/test_exp_base.py::TestExperimentMethods::test_multicell_shuffled_spikes_error PASSED [ 70%]
tests/unit/experiment/test_exp_base.py::TestExperimentMethods::test_get_neuron_feature_pair_stats PASSED [ 71%]
tests/unit/experiment/test_exp_base.py::TestExperimentMethods::test_get_significance_slice PASSED [ 72%]
tests/unit/experiment/test_exp_base.py::TestExperimentMethods::test_update_neuron_feature_pair_significance PASSED [ 72%]
tests/unit/experiment/test_exp_base.py::TestExperimentMethods::test_add_multifeature_to_stats PASSED [ 73%]
tests/unit/experiment/test_exp_base.py::TestExperimentMethods::test_compute_rdm PASSED [ 74%]
tests/unit/experiment/test_exp_base.py::TestExperimentMethods::test_process_fbunch_with_stats_table PASSED [ 75%]
tests/unit/experiment/test_exp_base.py::TestExperimentMethods::test_embedding_shape_validation PASSED [ 75%]
tests/unit/experiment/test_exp_base.py::TestExperimentMethods::test_check_stats_relevance_multifeature PASSED [ 76%]
tests/unit/experiment/test_exp_base.py::TestExperimentMethods::test_update_stats_force_update PASSED [ 77%]
tests/unit/experiment/test_exp_base.py::TestExperimentMethods::test_check_ds_no_fps PASSED [ 77%]
tests/unit/experiment/test_exp_base.py::TestExperimentMethods::test_trim_data_already_filtered PASSED [ 78%]
tests/unit/experiment/test_exp_base.py::TestExperimentMethods::test_add_multifeature_already_exists PASSED [ 79%]
tests/unit/experiment/test_exp_base.py::TestExperimentMethods::test_get_stats_relevance_missing_feature PASSED [ 79%]
tests/unit/experiment/test_exp_build.py::TestLoadExpFromAlignedData::test_basic_loading PASSED [ 80%]
tests/unit/experiment/test_exp_build.py::TestLoadExpFromAlignedData::test_input_validation PASSED [ 81%]
tests/unit/experiment/test_exp_build.py::TestLoadExpFromAlignedData::test_missing_calcium PASSED [ 81%]
tests/unit/experiment/test_exp_build.py::TestLoadExpFromAlignedData::test_case_insensitive_keys PASSED [ 82%]
tests/unit/experiment/test_exp_build.py::TestLoadExpFromAlignedData::test_garbage_feature_removal PASSED [ 83%]
tests/unit/experiment/test_exp_build.py::TestLoadExpFromAlignedData::test_force_continuous PASSED [ 83%]
tests/unit/experiment/test_exp_build.py::TestLoadExpFromAlignedData::test_force_continuous_override PASSED [ 84%]
tests/unit/experiment/test_exp_build.py::TestLoadExpFromAlignedData::test_bad_frames_mask PASSED [ 85%]
tests/unit/experiment/test_exp_build.py::TestLoadExpFromAlignedData::test_static_features_defaults PASSED [ 85%]
tests/unit/experiment/test_exp_build.py::TestLoadExpFromAlignedData::test_static_features_override PASSED [ 86%]
tests/unit/experiment/test_exp_build.py::TestLoadExpFromAlignedData::test_reconstruct_spikes_parameter PASSED [ 87%]
tests/unit/experiment/test_exp_build.py::TestLoadExpFromAlignedData::test_verbose_output PASSED [ 87%]
tests/unit/experiment/test_exp_build.py::TestLoadExpFromAlignedData::test_empty_features_handling PASSED [ 88%]
tests/unit/experiment/test_exp_build.py::TestLoadExperiment::test_load_from_existing_pickle PASSED [ 89%]
tests/unit/experiment/test_exp_build.py::TestLoadExperiment::test_force_rebuild PASSED [ 89%]
tests/unit/experiment/test_exp_build.py::TestLoadExperiment::test_download_from_gdrive PASSED [ 90%]
tests/unit/experiment/test_exp_build.py::TestLoadExperiment::test_download_failure PASSED [ 91%]
tests/unit/experiment/test_exp_build.py::TestLoadExperiment::test_non_iabs_source PASSED [ 91%]
tests/unit/experiment/test_exp_build.py::TestLoadExperiment::test_save_to_pickle_option PASSED [ 92%]
tests/unit/experiment/test_exp_build.py::TestLoadExperiment::test_custom_paths PASSED [ 93%]
tests/unit/experiment/test_exp_build.py::TestLoadExperiment::test_root_directory_creation PASSED [ 93%]
tests/unit/experiment/test_exp_build.py::TestLoadExperiment::test_root_not_directory PASSED [ 94%]
tests/unit/experiment/test_exp_build.py::TestPickleFunctions::test_save_and_load_pickle PASSED [ 95%]
tests/unit/experiment/test_exp_build.py::TestPickleFunctions::test_save_pickle_verbose PASSED [ 95%]
tests/unit/experiment/test_exp_build.py::TestPickleFunctions::test_load_pickle_verbose PASSED [ 96%]
tests/unit/experiment/test_exp_build.py::TestPickleFunctions::test_load_nonexistent_pickle PASSED [ 97%]
tests/unit/experiment/test_exp_build.py::TestPickleFunctions::test_save_to_invalid_path PASSED [ 97%]
tests/unit/experiment/test_exp_build.py::TestEdgeCases::test_is_garbage_edge_cases PASSED [ 98%]
tests/unit/experiment/test_exp_build.py::TestEdgeCases::test_deepcopy_behavior PASSED [ 99%]
tests/unit/experiment/test_exp_build.py::TestEdgeCases::test_large_bad_frames_list PASSED [100%]

=================================== FAILURES ===================================
_____________________ test_duplicate_behavior_in_pipelines _____________________
tests/unit/experiment/test_duplicate_behavior.py:114: in test_duplicate_behavior_in_pipelines
    stats, significance, info, results = compute_cell_feat_significance(
src/driada/intense/pipelines.py:238: in compute_cell_feat_significance
    precomputed_mask_stage1 = np.ones((n, f))
E   NameError: name 'np' is not defined
---------------------------- Captured stdout setup -----------------------------
Generating features...
Generating signals...
Generating features...
Generating signals...
Building neurons...
Building data hashes...
Final checkpoint...
Experiment "Synthetic" constructed successfully with 5 neurons and 4 features
---------------------------- Captured stderr setup -----------------------------

  0%|          | 0/2 [00:00<?, ?it/s]
100%|██████████| 2/2 [00:00<00:00, 5249.44it/s]

  0%|          | 0/3 [00:00<?, ?it/s]
100%|██████████| 3/3 [00:00<00:00, 758.56it/s]

  0%|          | 0/2 [00:00<?, ?it/s]
100%|██████████| 2/2 [00:00<00:00, 95.85it/s]

  0%|          | 0/2 [00:00<?, ?it/s]
100%|██████████| 2/2 [00:00<00:00, 644.68it/s]
/Users/nikita/PycharmProjects/driada2/src/driada/experiment/exp_base.py:140: UserWarning: No spike data provided, spikes reconstruction from Ca2+ data disabled
  warnings.warn(

  0%|          | 0/5 [00:00<?, ?it/s]
100%|██████████| 5/5 [00:00<00:00, 163.65it/s]
____________________ test_reconstruct_spikes_custom_method _____________________
tests/unit/experiment/test_spike_reconstruction_refactor.py:96: in test_reconstruct_spikes_custom_method
    spikes, metadata = reconstruct_spikes(
src/driada/experiment/spike_reconstruction.py:53: in reconstruct_spikes
    return method(calcium, fps, params)
tests/unit/experiment/test_spike_reconstruction_refactor.py:84: in custom_method
    spikes = MultiTimeSeries(spike_ts_list)
src/driada/information/info_base.py:466: in __init__
    super().__init__(
src/driada/dim_reduction/data.py:106: in __init__
    check_data_for_errors(self.data, verbose=verbose)
src/driada/dim_reduction/data.py:53: in check_data_for_errors
    raise ValueError(
E   ValueError: Data contains 937 zero columns (all values are 0). This can cause issues in dimensionality reduction. Consider removing these columns or adding small noise.
---------------------------- Captured stdout setup -----------------------------
Generating features...
Generating signals...
Generating features...
Generating signals...
Building neurons...
Building data hashes...
Final checkpoint...
Experiment "Synthetic" constructed successfully with 5 neurons and 4 features
---------------------------- Captured stderr setup -----------------------------

  0%|          | 0/2 [00:00<?, ?it/s]
100%|██████████| 2/2 [00:00<00:00, 13421.77it/s]

  0%|          | 0/3 [00:00<?, ?it/s]
100%|██████████| 3/3 [00:00<00:00, 814.32it/s]

  0%|          | 0/2 [00:00<?, ?it/s]
100%|██████████| 2/2 [00:00<00:00, 97.87it/s]

  0%|          | 0/2 [00:00<?, ?it/s]
100%|██████████| 2/2 [00:00<00:00, 639.13it/s]
/Users/nikita/PycharmProjects/driada2/src/driada/experiment/exp_base.py:140: UserWarning: No spike data provided, spikes reconstruction from Ca2+ data disabled
  warnings.warn(

  0%|          | 0/5 [00:00<?, ?it/s]
100%|██████████| 5/5 [00:00<00:00, 160.85it/s]
_________________ TestNeuronMethods.test_calc_snr_nan_handling _________________
tests/unit/experiment/test_neuron.py:184: in test_calc_snr_nan_handling
    neuron = Neuron("cell_10", ca_data, sp_data)
src/driada/experiment/neuron.py:152: in __init__
    self.ca = TimeSeries(Neuron.calcium_preprocessing(ca), discrete=False)
src/driada/information/info_base.py:194: in __init__
    self._check_input()
src/driada/information/info_base.py:103: in _check_input
    raise ValueError("Time series contains NaN values")
E   ValueError: Time series contains NaN values
_______________________________ test_intense_exp _______________________________
tests/unit/experiment/test_exp.py:12: in test_intense_exp
    res_ = compute_cell_feat_significance(
src/driada/intense/pipelines.py:238: in compute_cell_feat_significance
    precomputed_mask_stage1 = np.ones((n, f))
E   NameError: name 'np' is not defined
---------------------------- Captured stdout setup -----------------------------
Generating features...
Generating signals...
Generating features...
Generating signals...
Building neurons...
Building data hashes...
Final checkpoint...
Experiment "Synthetic" constructed successfully with 20 neurons and 6 features
---------------------------- Captured stderr setup -----------------------------

  0%|          | 0/3 [00:00<?, ?it/s]
100%|██████████| 3/3 [00:00<00:00, 14479.76it/s]

  0%|          | 0/10 [00:00<?, ?it/s]
100%|██████████| 10/10 [00:00<00:00, 292.77it/s]

  0%|          | 0/3 [00:00<?, ?it/s]
100%|██████████| 3/3 [00:00<00:00, 30.73it/s]

  0%|          | 0/10 [00:00<?, ?it/s]
100%|██████████| 10/10 [00:00<00:00, 216.02it/s]
/Users/nikita/PycharmProjects/driada2/src/driada/experiment/exp_base.py:140: UserWarning: No spike data provided, spikes reconstruction from Ca2+ data disabled
  warnings.warn(

  0%|          | 0/20 [00:00<?, ?it/s]
 30%|███       | 6/20 [00:00<00:00, 51.50it/s]
 60%|██████    | 12/20 [00:00<00:00, 51.36it/s]
 90%|█████████ | 18/20 [00:00<00:00, 51.33it/s]
100%|██████████| 20/20 [00:00<00:00, 51.33it/s]
================================ tests coverage ================================
______________ coverage: platform darwin, python 3.10.18-final-0 _______________

Name                                                       Stmts   Miss Branch BrPart   Cover   Missing
-------------------------------------------------------------------------------------------------------
src/driada/dimensionality/effective.py                        27     27     12      0   0.00%   1-48
src/driada/dimensionality/intrinsic.py                       119    119     48      0   0.00%   8-403
src/driada/dimensionality/linear.py                           54     54     16      0   0.00%   8-218
src/driada/dimensionality/utils.py                            42     42      8      0   0.00%   1-91
src/driada/gdrive/auth.py                                     13     13      0      0   0.00%   1-19
src/driada/gdrive/upload.py                                   37     37     10      0   0.00%   1-69
src/driada/integration/selectivity_mapper.py                 123    123     60      0   0.00%   8-428
src/driada/network/drawing.py                                134    134     54      0   0.00%   1-225
src/driada/network/quantum.py                                 40     40      8      0   0.00%   1-69
src/driada/utils/visual.py                                   283    271    134      0   2.88%   63-270, 304-405, 448-546, 591-681, 718-778, 811-858
src/driada/intense/disentanglement.py                        148    140     72      0   3.64%   59-122, 183-280, 304-319, 348-406
src/driada/intense/visual.py                                 236    224     70      0   3.92%   30-66, 112-174, 218-292, 364-424, 466-549, 605-754
src/driada/network/randomization.py                          310    293     94      0   4.21%   43-53, 97-253, 289-342, 374-415, 434-447, 474-643, 712-740
src/driada/experiment/synthetic/mixed_selectivity.py         143    133     80      0   4.48%   56-92, 128-205, 243-281, 361-516
src/driada/intense/pipelines.py                              287    268    170      3   4.81%   200-203, 213-234, 239-467, 577-701, 812-938, 1038-1173
src/driada/rsa/core.py                                       164    148     84      0   6.45%   47-84, 116-143, 179-234, 256-282, 327-367, 441-508, 569-621
src/driada/rsa/core_jit.py                                    95     85     58      0   6.54%   26-106, 128-142, 160-173, 191-203
src/driada/dim_reduction/manifold_metrics.py                 313    286     98      0   6.57%   39-43, 77-102, 126-160, 184-218, 249-280, 302-312, 335-385, 417-460, 491-518, 539-540, 556-558, 574-583, 615-652, 673-693, 731-781, 807-828, 865-900, 922-962, 996-1026, 1060-1088, 1122-1167
src/driada/rsa/visual.py                                      78     71     28      0   6.60%   53-155, 186-224
src/driada/utils/spatial.py                                  213    194     74      0   6.62%   60-93, 129-162, 195-232, 256-274, 300-336, 380-421, 450-494, 522-548, 576-603, 652-725, 754-780
src/driada/dim_reduction/graph.py                            242    218     90      0   7.23%   26-76, 83-96, 99-100, 103-116, 121-139, 142-200, 203-215, 219-275, 279-385, 390-397, 460-546
src/driada/dim_reduction/embedding.py                        328    294     82      0   8.29%   19-21, 29-33, 42-67, 70-81, 84-89, 93-100, 104-118, 121-142, 145-147, 150-154, 157-178, 181-196, 212-279, 287-305, 308-310, 313-319, 345-571, 595-743, 748-752, 775-782
src/driada/network/net_base.py                               387    340    172      0   8.41%   44-56, 63-64, 68-72, 76-88, 96-115, 137-196, 202-250, 257-323, 326-327, 331-363, 367-390, 393-406, 409-428, 431-437, 440-446, 449-455, 458-464, 482-555, 560-589, 592-604, 608-621, 624-626, 629-631, 634-636, 639-641, 644-648, 651-661, 664-692
src/driada/experiment/synthetic/utils.py                       7      6      4      0   9.09%   28-37
src/driada/utils/signals.py                                   82     71     34      0   9.48%   81-98, 156-177, 218-289, 313-320, 339-359
src/driada/network/matrix_utils.py                           203    178     60      0   9.51%   18-31, 35-36, 40-45, 58-96, 100-107, 111-118, 122-124, 129-175, 179-186, 190-195, 199, 207-210, 214-225, 229-236, 240-251, 255-263, 268-272, 276-283, 287-296, 300-307, 311-314, 318-321
src/driada/network/spectral.py                                30     26      8      0  10.53%   6-8, 24-37, 41-55
src/driada/utils/plot.py                                      37     31     18      0  10.91%   55-80, 119-135, 173-186
src/driada/dim_reduction/mvu.py                               68     58     22      0  11.11%   8-10, 37-50, 61-146, 158-184
src/driada/rsa/integration.py                                 46     38     22      0  11.76%   62-113, 146-148, 195-233
src/driada/information/entropy_jit.py                         44     38      4      0  12.50%   32-66, 85-128
src/driada/utils/matrix.py                                    24     20      4      0  14.29%   17-45, 50-54
src/driada/dim_reduction/sequences.py                         22     17     12      0  14.71%   67-101
src/driada/network/graph_utils.py                             47     38     12      0  15.25%   8-17, 22-34, 38-41, 45-49, 53-55, 59-81
src/driada/dim_reduction/dr_base.py                           82     61     46      0  16.41%   191-215, 223-238, 247-256, 277-339
src/driada/gdrive/gdrive_utils.py                             73     56     30      0  16.50%   25-28, 31, 61-105, 135-194, 198-204
src/driada/utils/gif.py                                       36     27     14      0  18.00%   21-29, 44-53, 81-108
src/driada/information/entropy.py                             55     41     14      0  20.29%   18-19, 42-52, 68, 89-101, 125-139, 161-173, 198-201, 224-227
src/driada/dim_reduction/neural.py                           131    100     24      1  20.65%   12-15, 21-42, 45-55, 62-83, 86-93, 99-120, 123-132, 138-157, 160-162, 165-167, 181-200, 207-210, 213-227, 231-235, 239-240, 248-249, 252, 255-263
src/driada/information/gcmi_jit_utils.py                     206    157     66      3  22.79%   72-78, 103, 105, 127-143, 182-188, 211-270, 297-397, 416-432, 454-467
src/driada/dim_reduction/data.py                             128     91     66      5  23.71%   34, 44-51, 100, 111-112, 122, 127-141, 158-163, 180-212, 255-335, 338-343, 346-348, 351-353
src/driada/gdrive/download.py                                103     68     46      2  24.83%   30-79, 94-138, 165-212, 220
src/driada/information/ksg.py                                 87     58     20      2  28.97%   39-42, 46, 55, 65-83, 94->96, 108-111, 129-169, 173-192
src/driada/information/info_base.py                          455    289    220     33  32.15%   46-73, 91, 95, 99, 105, 109-112, 116-151, 199-207, 210-218, 236-242, 274, 277-281, 284-285, 288-292, 295-296, 306-310, 336-354, 397-409, 434-454, 495-497, 511, 517, 533, 538, 543, 551->553, 558-565, 593-615, 626-629, 634-641, 671-674, 694-740, 772-775, 781-810, 815-839, 844->855, 856, 859, 862, 874, 908-911, 923, 930-963, 965->exit, 974-983, 992-1016, 1025-1030, 1036-1047, 1080-1090, 1134-1240, 1279-1295
src/driada/utils/data.py                                     157    101     74      7  32.47%   34-52, 72, 74, 82-83, 95, 97, 106, 112-141, 145-147, 175-177, 181-184, 188-198, 216-238, 250-252, 294-305, 312-315, 327-344, 358-389
src/driada/information/gcmi.py                               250    156     78      9  33.23%   37-38, 50-55, 79, 146-147, 166, 184->195, 218, 227, 233, 251->259, 280-341, 353-391, 411-478, 493-544
src/driada/utils/jit.py                                       27     17      4      1  35.48%   20-30, 63-66, 74, 79-85
src/driada/intense/stats.py                                  104     58     44      5  37.16%   23-24, 43-45, 64-66, 90-91, 122, 151-154, 175-187, 216, 245-253, 274-281, 318, 330->329, 345-349, 372-382, 401-406
src/driada/intense/intense_base.py                           410    232    220     42  39.05%   25-27, 49, 51, 54->75, 59-64, 67-72, 85, 89, 93, 124-148, 176, 179, 182, 185, 248-270, 329-361, 438-518, 598, 602->605, 622, 625, 634-644, 674-695, 727-728, 807, 814->818, 819-821, 934, 984, 988, 992-993, 997-998, 1175, 1181, 1187, 1200->1211, 1206, 1211->1213, 1213->1218, 1219-1220, 1238->1251, 1245-1249, 1258-1273, 1280, 1287->1368, 1290, 1331, 1340, 1363-1364, 1376-1492, 1541-1582
src/driada/utils/naming.py                                    13      6      6      1  42.11%   18-27
src/driada/experiment/synthetic/manifold_spatial_3d.py       108     45     46      6  56.49%   39->42, 58-59, 96-98, 155, 168->179, 187, 275-328, 402-496
src/driada/information/info_utils.py                          41     16      8      1  61.22%   12-13, 75-99
src/driada/experiment/synthetic/core.py                       39     14     16      3  61.82%   75-80, 93, 101, 154-171
src/driada/experiment/synthetic/manifold_circular.py          73     22     24      7  65.98%   33->37, 204->207, 210, 214, 219, 232, 253, 312-402
src/driada/experiment/synthetic/experiment_generators.py     276     78    146     38  66.35%   112, 133, 143, 152, 166, 186-191, 254->259, 260-261, 308, 438, 443, 452, 455, 467-470, 483->495, 502->626, 504, 509-538, 583-616, 628->664, 630, 665-690, 694->760, 697, 740, 760->980, 762, 779-784, 791-816, 839->876, 876->916, 917-918, 933->929, 945-972, 981, 1030-1032, 1035
src/driada/experiment/wavelet_event_detection.py             154     42     40      1  69.59%   8, 37-40, 46-123
src/driada/information/time_series_types.py                  231     53    116     33  71.76%   39, 47, 81, 97, 119, 177-178, 189-192, 203-204, 214, 229, 246->259, 255->259, 270-287, 311->329, 317->329, 318->317, 342-343, 358-359, 367, 372-374, 389, 390->394, 396, 397->401, 402, 403->407, 408, 414, 415->419, 430, 435, 442, 465, 472, 479->487, 482->487, 514-536, 559-563
src/driada/experiment/synthetic/manifold_spatial_2d.py        98     20     40      7  78.99%   157->165, 173, 266, 270, 275, 290, 311, 380-471
src/driada/experiment/exp_base.py                            464     72    268     47  80.19%   71, 185, 192->194, 256->255, 258, 285->287, 291->293, 296->exit, 307->exit, 338, 343, 397, 408-414, 418, 424, 446, 460, 474-479, 531->529, 567, 571->exit, 580, 588, 593->595, 605, 637->643, 660, 680-681, 690->exit, 706-707, 713, 728-729, 738-745, 782, 795-803, 838, 846, 859-867, 891, 947->955, 949->955, 974-975, 978-979, 981->988, 1033, 1079, 1101-1102, 1105-1110, 1113, 1116, 1119-1120, 1178, 1238->1241
src/driada/experiment/exp_build.py                           119     16     72      6  82.20%   86, 97-114, 183, 187-190, 194, 233
src/driada/utils/output.py                                    16      1      4      1  90.00%   19
src/driada/experiment/synthetic/time_series.py                79      6     24      1  91.26%   138, 247-258
src/driada/experiment/neuron.py                              172      4     38      6  95.24%   149, 220->225, 228->230, 238, 323, 346
src/driada/experiment/wavelet_ridge.py                        66      1      4      1  97.14%   65
src/driada/experiment/spike_reconstruction.py                 48      0      8      0 100.00%
src/driada/utils/neural.py                                    20      0      4      0 100.00%
-------------------------------------------------------------------------------------------------------
TOTAL                                                       8747   5983   3552    272  28.75%
Coverage HTML written to dir htmlcov
Coverage XML written to file coverage.xml
Coverage JSON written to file coverage.json
=========================== short test summary info ============================
FAILED tests/unit/experiment/test_duplicate_behavior.py::test_duplicate_behavior_in_pipelines - NameError: name 'np' is not defined
FAILED tests/unit/experiment/test_spike_reconstruction_refactor.py::test_reconstruct_spikes_custom_method - ValueError: Data contains 937 zero columns (all values are 0). This can cause issues in dimensionality reduction. Consider removing these columns or adding small noise.
FAILED tests/unit/experiment/test_neuron.py::TestNeuronMethods::test_calc_snr_nan_handling - ValueError: Time series contains NaN values
FAILED tests/unit/experiment/test_exp.py::test_intense_exp - NameError: name 'np' is not defined
======================== 4 failed, 144 passed in 58.56s ========================

ERROR conda.cli.main_run:execute(125): `conda run python /var/folders/6k/qvnh55652hvfzbwp8wl6fwsr0000gq/T/tmp8nu0gpfs.py` failed. (See above for error)
