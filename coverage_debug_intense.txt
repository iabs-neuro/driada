============================= test session starts ==============================
platform darwin -- Python 3.10.18, pytest-8.4.1, pluggy-1.6.0 -- /opt/anaconda3/envs/driada/bin/python
cachedir: .pytest_cache
rootdir: /Users/nikita/PycharmProjects/driada2
configfile: pytest.ini
plugins: timeout-2.4.0, cov-6.2.1
collecting ... collected 98 items

tests/unit/intense/test_disentanglement.py::test_disentangle_pair_redundant PASSED [  1%]
tests/unit/intense/test_disentanglement.py::test_disentangle_pair_redundant_verbose PASSED [  2%]
tests/unit/intense/test_disentanglement.py::test_disentangle_pair_synergistic PASSED [  3%]
tests/unit/intense/test_disentanglement.py::test_disentangle_pair_undistinguishable PASSED [  4%]
tests/unit/intense/test_disentanglement.py::test_disentangle_pair_zero_mi PASSED [  5%]
tests/unit/intense/test_disentanglement.py::test_disentangle_pair_dominant_feature PASSED [  6%]
tests/unit/intense/test_disentanglement.py::test_disentangle_pair_downsampling PASSED [  7%]
tests/unit/intense/test_disentanglement.py::test_disentangle_pair_discrete PASSED [  8%]
tests/unit/intense/test_disentanglement.py::test_disentangle_all_selectivities_basic[medium] PASSED [  9%]
tests/unit/intense/test_disentanglement.py::test_disentangle_all_selectivities_cell_bunch[medium] PASSED [ 10%]
tests/unit/intense/test_disentanglement.py::test_disentangle_all_selectivities_with_significance[small] PASSED [ 11%]
tests/unit/intense/test_disentanglement.py::test_disentangle_all_selectivities_multifeature[small] PASSED [ 12%]
tests/unit/intense/test_disentanglement.py::test_disentangle_all_selectivities_empty_neurons[small] PASSED [ 13%]
tests/unit/intense/test_disentanglement.py::test_disentangle_all_selectivities_error_handling[small] PASSED [ 14%]
tests/unit/intense/test_disentanglement.py::test_create_multifeature_map_valid[small] PASSED [ 15%]
tests/unit/intense/test_disentanglement.py::test_create_multifeature_map_invalid[small] PASSED [ 16%]
tests/unit/intense/test_disentanglement.py::test_create_multifeature_map_empty[small] PASSED [ 17%]
tests/unit/intense/test_disentanglement.py::test_get_disentanglement_summary_basic PASSED [ 18%]
tests/unit/intense/test_disentanglement.py::test_get_disentanglement_summary_with_significance PASSED [ 19%]
tests/unit/intense/test_disentanglement.py::test_get_disentanglement_summary_empty PASSED [ 20%]
tests/unit/intense/test_disentanglement.py::test_get_disentanglement_summary_redundant PASSED [ 21%]
tests/unit/intense/test_disentanglement.py::test_disentangle_pair_short_timeseries PASSED [ 22%]
tests/unit/intense/test_disentanglement.py::test_disentangle_pair_identical_timeseries PASSED [ 23%]
tests/unit/intense/test_disentanglement.py::test_disentangle_pair_constant_timeseries PASSED [ 24%]
tests/unit/intense/test_disentanglement.py::test_disentangle_pair_mixed_discrete_continuous PASSED [ 25%]
tests/unit/intense/test_disentanglement.py::test_disentangle_pair_high_downsampling PASSED [ 26%]
tests/unit/intense/test_disentanglement.py::test_default_multifeature_map PASSED [ 27%]
tests/unit/intense/test_stats.py::test_chebyshev_ineq PASSED             [ 28%]
tests/unit/intense/test_stats.py::test_get_lognormal_p PASSED            [ 29%]
tests/unit/intense/test_stats.py::test_get_gamma_p PASSED                [ 30%]
tests/unit/intense/test_stats.py::test_get_distribution_function PASSED  [ 31%]
tests/unit/intense/test_stats.py::test_get_mi_distr_pvalue PASSED        [ 32%]
tests/unit/intense/test_stats.py::test_get_mask PASSED                   [ 33%]
tests/unit/intense/test_stats.py::test_stats_not_empty PASSED            [ 34%]
tests/unit/intense/test_stats.py::test_criterion1 PASSED                 [ 35%]
tests/unit/intense/test_stats.py::test_criterion2 PASSED                 [ 36%]
tests/unit/intense/test_stats.py::test_get_all_nonempty_pvals PASSED     [ 37%]
tests/unit/intense/test_stats.py::test_get_table_of_stats PASSED         [ 38%]
tests/unit/intense/test_stats.py::test_merge_stage_stats PASSED          [ 39%]
tests/unit/intense/test_stats.py::test_merge_stage_significance PASSED   [ 40%]
tests/unit/intense/test_stats.py::test_edge_cases_and_numerical_stability PASSED [ 41%]
tests/unit/intense/test_stats.py::test_distribution_fitting_edge_cases PASSED [ 42%]
tests/unit/intense/test_intense.py::test_stage1 PASSED                   [ 43%]
tests/unit/intense/test_intense.py::test_two_stage PASSED                [ 44%]
tests/unit/intense/test_intense.py::test_mixed_dimensions PASSED         [ 45%]
tests/unit/intense/test_intense.py::test_mirror PASSED                   [ 46%]
tests/unit/intense/test_intense.py::test_two_stage_corr PASSED           [ 47%]
tests/unit/intense/test_intense.py::test_two_stage_avsignal PASSED       [ 48%]
tests/unit/intense/test_intense.py::test_calculate_optimal_delays PASSED [ 50%]
tests/unit/intense/test_intense.py::test_validate_time_series_bunches_empty PASSED [ 51%]
tests/unit/intense/test_intense.py::test_validate_metric PASSED          [ 52%]
tests/unit/intense/test_intense.py::test_validate_common_parameters PASSED [ 53%]
tests/unit/intense/test_intense.py::test_multicomp_correction PASSED     [ 54%]
tests/unit/intense/test_intense.py::test_intense_results PASSED          [ 55%]
tests/unit/intense/test_intense.py::test_stats_functions PASSED          [ 56%]
tests/unit/intense/test_intense.py::test_get_table_of_stats PASSED       [ 57%]
tests/unit/intense/test_intense.py::test_merge_stage_stats PASSED        [ 58%]
tests/unit/intense/test_intense.py::test_merge_stage_significance PASSED [ 59%]
tests/unit/intense/test_intense.py::test_scan_pairs PASSED               [ 60%]
tests/unit/intense/test_intense.py::test_scan_pairs_router PASSED        [ 61%]
tests/unit/intense/test_intense.py::test_intenseresults_save_load PASSED [ 62%]
tests/unit/intense/test_intense.py::test_validate_common_parameters_edge_cases PASSED [ 63%]
tests/unit/intense/test_intense.py::test_validate_metric_scipy_functions PASSED [ 64%]
tests/unit/intense/test_intense.py::test_get_mi_distr_pvalue_edge_cases PASSED [ 65%]
tests/unit/intense/test_intense.py::test_validate_time_series_bunches_mixed_dimensions PASSED [ 66%]
tests/unit/intense/test_intense.py::test_get_multicomp_correction_fdr PASSED [ 67%]
tests/unit/intense/test_intense.py::test_compute_cell_feat_significance_integration PASSED [ 68%]
tests/unit/intense/test_intense.py::test_stats_not_empty_stage2 PASSED   [ 69%]
tests/unit/intense/test_intense.py::test_parallel_mi_equality PASSED     [ 70%]
tests/unit/intense/test_intense.py::test_parallel_router PASSED          [ 71%]
tests/unit/intense/test_intense.py::test_optimal_delays_parallel PASSED  [ 72%]
tests/unit/intense/test_intense.py::test_criterion1_edge_cases PASSED    [ 73%]
tests/unit/intense/test_intense.py::test_criterion2_edge_cases PASSED    [ 74%]
tests/unit/intense/test_intense.py::test_compute_me_stats_stage2_only PASSED [ 75%]
tests/unit/intense/test_intense.py::test_correlation_detection_scaled[scaled_correlated_ts0] PASSED [ 76%]
tests/unit/intense/test_intense.py::test_correlation_detection_scaled[scaled_correlated_ts1] PASSED [ 77%]
tests/unit/intense/test_intense.py::test_correlation_detection_scaled[scaled_correlated_ts2] PASSED [ 78%]
tests/unit/intense/test_intense.py::test_get_calcium_feature_me_profile_cbunch_fbunch PASSED [ 79%]
tests/unit/intense/test_intense.py::test_intense_handles_no_significant_neurons PASSED [ 80%]
tests/unit/intense/test_intense_pipelines_optimized.py::test_compute_cell_feat_significance_with_disentanglement_fast FAILED [ 81%]
tests/unit/intense/test_intense_pipelines_optimized.py::test_compute_cell_feat_significance_continuous_fast[small] PASSED [ 82%]
tests/unit/intense/test_intense_pipelines_optimized.py::test_compute_feat_feat_significance_fast[small] PASSED [ 83%]
tests/unit/intense/test_intense_pipelines_optimized.py::test_compute_cell_cell_significance_fast[small] PASSED [ 84%]
tests/unit/intense/test_intense_pipelines_optimized.py::test_mixed_selectivity_generation_fast PASSED [ 85%]
tests/unit/intense/test_intense_pipelines_optimized.py::test_disentanglement_minimal FAILED [ 86%]
tests/unit/intense/test_intense_pipelines_optimized.py::TestEdgeCasesFast::test_empty_cell_bunch PASSED [ 87%]
tests/unit/intense/test_intense_pipelines_optimized.py::TestEdgeCasesFast::test_single_neuron PASSED [ 88%]
tests/unit/intense/test_intense_pipelines_optimized.py::TestEdgeCasesFast::test_single_feature PASSED [ 89%]
tests/unit/intense/test_intense_pipelines_optimized.py::TestPerformanceBenchmarks::test_all_functions_under_5s PASSED [ 90%]
tests/unit/intense/test_intense_pipelines_optimized.py::test_compute_cell_cell_significance_comprehensive PASSED [ 91%]
tests/unit/intense/test_intense_pipelines_optimized.py::test_compute_cell_cell_significance_with_spikes PASSED [ 92%]
tests/unit/intense/test_intense_pipelines_optimized.py::test_compute_cell_cell_significance_error_cases PASSED [ 93%]
tests/unit/intense/test_intense_pipelines_optimized.py::test_compute_embedding_selectivity_basic PASSED [ 94%]
tests/unit/intense/test_intense_pipelines_optimized.py::test_compute_embedding_selectivity_multiple_methods PASSED [ 95%]
tests/unit/intense/test_intense_pipelines_optimized.py::test_compute_embedding_selectivity_error_cases PASSED [ 96%]
tests/unit/intense/test_intense_pipelines_optimized.py::test_compute_feat_feat_significance_edge_cases FAILED [ 97%]
tests/unit/intense/test_intense_pipelines_optimized.py::test_compute_cell_feat_significance_error_paths FAILED [ 98%]
tests/unit/intense/test_intense_pipelines_optimized.py::test_cell_cell_with_identical_spike_data FAILED [100%]

=================================== FAILURES ===================================
________ test_compute_cell_feat_significance_with_disentanglement_fast _________
tests/unit/intense/test_intense_pipelines_optimized.py:44: in test_compute_cell_feat_significance_with_disentanglement_fast
    stats, significance, info, results, disent_results = compute_cell_feat_significance(
src/driada/intense/pipelines.py:415: in compute_cell_feat_significance
    print(f"Total mixed selectivity pairs analyzed: {summary['overall_stats']['total_neuron_pairs']}")
E   KeyError: 'total_neuron_pairs'
---------------------------- Captured stdout setup -----------------------------
Generating features...
Generating signals...
Generating features...
Generating signals...
Building neurons...
Building data hashes...
Final checkpoint...
Experiment "Synthetic" constructed successfully with 5 neurons and 4 features
---------------------------- Captured stderr setup -----------------------------

  0%|          | 0/2 [00:00<?, ?it/s]
100%|██████████| 2/2 [00:00<00:00, 3389.34it/s]

  0%|          | 0/3 [00:00<?, ?it/s]
100%|██████████| 3/3 [00:00<00:00, 858.55it/s]

  0%|          | 0/2 [00:00<?, ?it/s]
100%|██████████| 2/2 [00:00<00:00, 101.98it/s]

  0%|          | 0/2 [00:00<?, ?it/s]
100%|██████████| 2/2 [00:00<00:00, 571.74it/s]
/Users/nikita/PycharmProjects/driada2/src/driada/experiment/exp_base.py:106: UserWarning: No spike data provided, spikes reconstruction from Ca2+ data disabled
  warnings.warn('No spike data provided, spikes reconstruction from Ca2+ data disabled')

  0%|          | 0/5 [00:00<?, ?it/s]
100%|██████████| 5/5 [00:00<00:00, 175.56it/s]
----------------------------- Captured stdout call -----------------------------
Retrieving saved stats data...
Calculating optimal delays:
Starting stage 1 scanning for 8/8 possible pairs
Computing significance for all pairs in stage 1...
Stage 1 results:
62.50% (5/8) of possible pairs identified as candidates

Performing mixed selectivity disentanglement analysis...
Computing behavioral similarity matrix for 4 features...
Features: ['d_feat_0', 'd_feat_1', 'c_feat_0', 'c_feat_1']
Starting stage 1 scanning for 6/16 possible pairs
Computing significance for all pairs in stage 1...
Stage 1 results:
0.00% (0/16) of possible pairs identified as candidates

Behavioral similarity matrix computation complete!
Feature pairs analyzed: 16
Significant pairs (stage 1): 0
Significant pairs (final): 0.0
Unique significant pairs: 0.0

Disentanglement analysis complete!
----------------------------- Captured stderr call -----------------------------

  0%|          | 0/2 [00:00<?, ?it/s]
100%|██████████| 2/2 [00:00<00:00, 38.30it/s]

  0%|          | 0/2 [00:00<?, ?it/s]
100%|██████████| 2/2 [00:00<00:00, 222.40it/s]
/Users/nikita/PycharmProjects/driada2/src/driada/experiment/exp_base.py:759: UserWarning: Feature 'c_feat_0' is continuous. Entropy may be negative. Consider using mutual information or other measures for continuous variables.
  warnings.warn(
/Users/nikita/PycharmProjects/driada2/src/driada/experiment/exp_base.py:759: UserWarning: Feature 'c_feat_1' is continuous. Entropy may be negative. Consider using mutual information or other measures for continuous variables.
  warnings.warn(
/Users/nikita/PycharmProjects/driada2/src/driada/experiment/exp_base.py:759: UserWarning: Feature 'c_feat_0' is continuous. Entropy may be negative. Consider using mutual information or other measures for continuous variables.
  warnings.warn(
/Users/nikita/PycharmProjects/driada2/src/driada/experiment/exp_base.py:759: UserWarning: Feature 'c_feat_1' is continuous. Entropy may be negative. Consider using mutual information or other measures for continuous variables.
  warnings.warn(

  0%|          | 0/4 [00:00<?, ?it/s]
100%|██████████| 4/4 [00:00<00:00, 570.54it/s]
_________________________ test_disentanglement_minimal _________________________
tests/unit/intense/test_intense_pipelines_optimized.py:147: in test_disentanglement_minimal
    result = compute_cell_feat_significance(
src/driada/intense/pipelines.py:415: in compute_cell_feat_significance
    print(f"Total mixed selectivity pairs analyzed: {summary['overall_stats']['total_neuron_pairs']}")
E   KeyError: 'total_neuron_pairs'
----------------------------- Captured stdout call -----------------------------
Generating features...
Generating signals...
Generating features...
Generating signals...
Building neurons...
Building data hashes...
Final checkpoint...
Experiment "Synthetic" constructed successfully with 3 neurons and 4 features
Downsampling constant is too high: some behaviour acts may be skipped. Current minimal behaviour time interval is set to 0.25 sec, downsampling 5 will create time gaps of 0.5 sec
Retrieving saved stats data...
Calculating optimal delays:
Starting stage 1 scanning for 8/8 possible pairs
Computing significance for all pairs in stage 1...
Stage 1 results:
37.50% (3/8) of possible pairs identified as candidates

Performing mixed selectivity disentanglement analysis...
Computing behavioral similarity matrix for 4 features...
Features: ['d_feat_0', 'd_feat_1', 'c_feat_0', 'c_feat_1']
Starting stage 1 scanning for 6/16 possible pairs
Computing significance for all pairs in stage 1...
Stage 1 results:
12.50% (2/16) of possible pairs identified as candidates

Behavioral similarity matrix computation complete!
Feature pairs analyzed: 16
Significant pairs (stage 1): 0
Significant pairs (final): 4.0
Unique significant pairs: 2.0

Disentanglement analysis complete!
----------------------------- Captured stderr call -----------------------------

  0%|          | 0/2 [00:00<?, ?it/s]
100%|██████████| 2/2 [00:00<00:00, 3383.87it/s]

  0%|          | 0/2 [00:00<?, ?it/s]
100%|██████████| 2/2 [00:00<00:00, 698.82it/s]

  0%|          | 0/2 [00:00<?, ?it/s]
100%|██████████| 2/2 [00:00<00:00, 144.45it/s]

  0%|          | 0/1 [00:00<?, ?it/s]
100%|██████████| 1/1 [00:00<00:00, 660.52it/s]
/Users/nikita/PycharmProjects/driada2/src/driada/experiment/exp_base.py:106: UserWarning: No spike data provided, spikes reconstruction from Ca2+ data disabled
  warnings.warn('No spike data provided, spikes reconstruction from Ca2+ data disabled')

  0%|          | 0/3 [00:00<?, ?it/s]
100%|██████████| 3/3 [00:00<00:00, 243.66it/s]

  0%|          | 0/2 [00:00<?, ?it/s]
100%|██████████| 2/2 [00:00<00:00, 50.73it/s]

  0%|          | 0/2 [00:00<?, ?it/s]
100%|██████████| 2/2 [00:00<00:00, 172.42it/s]
/Users/nikita/PycharmProjects/driada2/src/driada/experiment/exp_base.py:759: UserWarning: Feature 'c_feat_0' is continuous. Entropy may be negative. Consider using mutual information or other measures for continuous variables.
  warnings.warn(
/Users/nikita/PycharmProjects/driada2/src/driada/experiment/exp_base.py:759: UserWarning: Feature 'c_feat_1' is continuous. Entropy may be negative. Consider using mutual information or other measures for continuous variables.
  warnings.warn(
/Users/nikita/PycharmProjects/driada2/src/driada/experiment/exp_base.py:759: UserWarning: Feature 'c_feat_0' is continuous. Entropy may be negative. Consider using mutual information or other measures for continuous variables.
  warnings.warn(
/Users/nikita/PycharmProjects/driada2/src/driada/experiment/exp_base.py:759: UserWarning: Feature 'c_feat_1' is continuous. Entropy may be negative. Consider using mutual information or other measures for continuous variables.
  warnings.warn(

  0%|          | 0/4 [00:00<?, ?it/s]
100%|██████████| 4/4 [00:00<00:00, 490.56it/s]
________________ test_compute_feat_feat_significance_edge_cases ________________
tests/unit/intense/test_intense_pipelines_optimized.py:429: in test_compute_feat_feat_significance_edge_cases
    sim_mat2, sig_mat2, pval_mat2, feat_ids2, info2 = compute_feat_feat_significance(
src/driada/intense/pipelines.py:565: in compute_feat_feat_significance
    ts = aggregate_multiple_ts(*ts_list)
src/driada/information/info_base.py:762: in aggregate_multiple_ts
    raise ValueError('this is not applicable to discrete TimeSeries')
E   ValueError: this is not applicable to discrete TimeSeries
---------------------------- Captured stdout setup -----------------------------
Generating features...
Generating signals...
Generating features...
Generating signals...
Building neurons...
Building data hashes...
Final checkpoint...
Experiment "Synthetic" constructed successfully with 5 neurons and 4 features
---------------------------- Captured stderr setup -----------------------------

  0%|          | 0/2 [00:00<?, ?it/s]
100%|██████████| 2/2 [00:00<00:00, 2976.79it/s]

  0%|          | 0/3 [00:00<?, ?it/s]
100%|██████████| 3/3 [00:00<00:00, 723.90it/s]

  0%|          | 0/2 [00:00<?, ?it/s]
100%|██████████| 2/2 [00:00<00:00, 87.73it/s]

  0%|          | 0/2 [00:00<?, ?it/s]
100%|██████████| 2/2 [00:00<00:00, 493.71it/s]
/Users/nikita/PycharmProjects/driada2/src/driada/experiment/exp_base.py:106: UserWarning: No spike data provided, spikes reconstruction from Ca2+ data disabled
  warnings.warn('No spike data provided, spikes reconstruction from Ca2+ data disabled')

  0%|          | 0/5 [00:00<?, ?it/s]
100%|██████████| 5/5 [00:00<00:00, 150.69it/s]
----------------------------- Captured stdout call -----------------------------
No features to analyze - returning empty results
Computing behavioral similarity matrix for 2 features...
Features: ['d_feat_0', ('d_feat_0', 'd_feat_1')]
_______________ test_compute_cell_feat_significance_error_paths ________________
tests/unit/intense/test_intense_pipelines_optimized.py:455: in test_compute_cell_feat_significance_error_paths
    compute_cell_feat_significance(
src/driada/intense/pipelines.py:267: in compute_cell_feat_significance
    computed_stats, computed_significance, info = compute_me_stats(signals,
src/driada/intense/intense_base.py:1061: in compute_me_stats
    validate_time_series_bunches(ts_bunch1, ts_bunch2, allow_mixed_dimensions=allow_mixed_dimensions)
src/driada/intense/intense_base.py:44: in validate_time_series_bunches
    raise ValueError("ts_bunch2 cannot be empty")
E   ValueError: ts_bunch2 cannot be empty

During handling of the above exception, another exception occurred:
tests/unit/intense/test_intense_pipelines_optimized.py:454: in test_compute_cell_feat_significance_error_paths
    with pytest.raises(ValueError, match="Feature .* not found in experiment"):
E   AssertionError: Regex pattern did not match.
E    Regex: 'Feature .* not found in experiment'
E    Input: 'ts_bunch2 cannot be empty'
---------------------------- Captured stdout setup -----------------------------
Generating features...
Generating signals...
Generating features...
Generating signals...
Building neurons...
Building data hashes...
Final checkpoint...
Experiment "Synthetic" constructed successfully with 5 neurons and 4 features
---------------------------- Captured stderr setup -----------------------------

  0%|          | 0/2 [00:00<?, ?it/s]
100%|██████████| 2/2 [00:00<00:00, 3305.20it/s]

  0%|          | 0/3 [00:00<?, ?it/s]
100%|██████████| 3/3 [00:00<00:00, 857.38it/s]

  0%|          | 0/2 [00:00<?, ?it/s]
100%|██████████| 2/2 [00:00<00:00, 101.62it/s]

  0%|          | 0/2 [00:00<?, ?it/s]
100%|██████████| 2/2 [00:00<00:00, 573.66it/s]
/Users/nikita/PycharmProjects/driada2/src/driada/experiment/exp_base.py:106: UserWarning: No spike data provided, spikes reconstruction from Ca2+ data disabled
  warnings.warn('No spike data provided, spikes reconstruction from Ca2+ data disabled')

  0%|          | 0/5 [00:00<?, ?it/s]
100%|██████████| 5/5 [00:00<00:00, 175.93it/s]
----------------------------- Captured stdout call -----------------------------
Retrieving saved stats data...
___________________ test_cell_cell_with_identical_spike_data ___________________
tests/unit/intense/test_intense_pipelines_optimized.py:490: in test_cell_cell_with_identical_spike_data
    compute_cell_cell_significance(
src/driada/intense/pipelines.py:804: in compute_cell_cell_significance
    stats, significance, info = compute_me_stats(
src/driada/intense/intense_base.py:1178: in compute_me_stats
    random_shifts1, me_total1 = scan_pairs_router(ts_bunch1,
src/driada/intense/intense_base.py:832: in scan_pairs_router
    random_shifts, me_total = scan_pairs(ts_bunch1,
src/driada/intense/intense_base.py:612: in scan_pairs
    me0 = get_sim(ts1,
src/driada/information/info_base.py:427: in get_sim
    me = get_mi(ts1, ts2, shift=shift, ds=ds, k=k, estimator=estimator,
src/driada/information/info_base.py:552: in get_mi
    mi = get_1d_mi(x, y, shift=shift, ds=ds, k=k, estimator=estimator,
src/driada/information/info_base.py:610: in get_1d_mi
    raise ValueError('MI computation of a TimeSeries or MultiTimeSeries with itself is not allowed')
E   ValueError: MI computation of a TimeSeries or MultiTimeSeries with itself is not allowed
---------------------------- Captured stdout setup -----------------------------
Generating features...
Generating signals...
Generating features...
Generating signals...
Building neurons...
Building data hashes...
Final checkpoint...
Experiment "Synthetic" constructed successfully with 5 neurons and 4 features
---------------------------- Captured stderr setup -----------------------------

  0%|          | 0/2 [00:00<?, ?it/s]
100%|██████████| 2/2 [00:00<00:00, 3311.73it/s]

  0%|          | 0/3 [00:00<?, ?it/s]
100%|██████████| 3/3 [00:00<00:00, 856.21it/s]

  0%|          | 0/2 [00:00<?, ?it/s]
100%|██████████| 2/2 [00:00<00:00, 102.08it/s]

  0%|          | 0/2 [00:00<?, ?it/s]
100%|██████████| 2/2 [00:00<00:00, 571.59it/s]
/Users/nikita/PycharmProjects/driada2/src/driada/experiment/exp_base.py:106: UserWarning: No spike data provided, spikes reconstruction from Ca2+ data disabled
  warnings.warn('No spike data provided, spikes reconstruction from Ca2+ data disabled')

  0%|          | 0/5 [00:00<?, ?it/s]
100%|██████████| 5/5 [00:00<00:00, 175.90it/s]
----------------------------- Captured stdout call -----------------------------
Computing neuronal similarity matrix for 5 neurons...
Data type: spikes
Starting stage 1 scanning for 10/25 possible pairs
----------------------------- Captured stderr call -----------------------------

  0%|          | 0/5 [00:00<?, ?it/s]
  0%|          | 0/5 [00:00<?, ?it/s]
================================ tests coverage ================================
______________ coverage: platform darwin, python 3.10.18-final-0 _______________

Name                                                       Stmts   Miss Branch BrPart   Cover   Missing
-------------------------------------------------------------------------------------------------------
src/driada/dimensionality/effective.py                        26     26     12      0   0.00%   1-43
src/driada/dimensionality/intrinsic.py                       120    120     48      0   0.00%   8-389
src/driada/dimensionality/linear.py                           54     54     16      0   0.00%   8-218
src/driada/dimensionality/utils.py                            44     44      8      0   0.00%   1-91
src/driada/gdrive/auth.py                                     13     13      0      0   0.00%   1-18
src/driada/gdrive/upload.py                                   37     37     10      0   0.00%   1-61
src/driada/integration/selectivity_mapper.py                 125    125     60      0   0.00%   8-392
src/driada/utils/visual.py                                   285    271    134      0   3.34%   65-241, 275-361, 404-492, 537-623, 660-709, 742-788
src/driada/intense/visual.py                                 236    224     70      0   3.92%   30-54, 89-142, 177-227, 289-345, 381-455, 503-620
src/driada/network/randomization.py                          312    293     94      0   4.68%   42-52, 96-233, 269-320, 352-391, 408-421, 448-602, 671-702
src/driada/utils/naming.py                                    13     12      6      0   5.26%   2-27
src/driada/rsa/core.py                                       165    149     84      0   6.43%   45-78, 110-138, 174-225, 251-275, 320-358, 432-488, 549-595
src/driada/experiment/synthetic/manifold_spatial_3d.py       108     98     46      0   6.49%   37-64, 87-103, 143-196, 253-301, 364-470
src/driada/rsa/core_jit.py                                    95     85     58      0   6.54%   26-107, 129-143, 161-174, 192-204
src/driada/dim_reduction/manifold_metrics.py                 260    236     86      0   6.94%   39-43, 77-102, 130-164, 192-226, 257-288, 314-324, 349-399, 429-462, 493-523, 543-544, 560-562, 578-587, 611-629, 653-683, 703-741, 772-789, 823-849, 880-912
src/driada/utils/spatial.py                                  214    194     74      0   6.94%   61-93, 129-160, 193-228, 253-271, 299-332, 376-415, 444-490, 518-544, 572-599, 648-720, 749-777
src/driada/experiment/synthetic/manifold_spatial_2d.py        98     88     40      0   7.25%   37-64, 86-93, 133-182, 238-286, 341-440
src/driada/experiment/exp_build.py                           119    105     72      0   7.33%   24-125, 144-208, 212-215, 219-223
src/driada/dim_reduction/graph.py                            232    208     72      0   7.89%   26-65, 72-85, 88-89, 92-102, 105-117, 120-166, 169-179, 183-224, 228-315, 320-325, 386-459
src/driada/network/net_base.py                               385    340    172      0   8.08%   21-29, 34-35, 39-43, 47-57, 63-78, 98-155, 163-203, 213-270, 273-274, 278-309, 313-330, 333-346, 349-368, 371-377, 380-386, 389-395, 398-404, 422-489, 494-517, 520-530, 534-545, 548-550, 553-555, 558-560, 563-565, 568-572, 575-585, 588-614
src/driada/rsa/visual.py                                      80     71     28      0   8.33%   55-141, 172-210
src/driada/network/drawing.py                                133    117     54      0   8.56%   13-54, 57-68, 72-75, 80-131, 135-157, 161-174, 179-203
src/driada/experiment/synthetic/utils.py                       7      6      4      0   9.09%   27-34
src/driada/gdrive/download.py                                103     89     46      0   9.40%   21-59, 73-111, 122-170, 174-193
src/driada/dim_reduction/embedding.py                        276    243     72      0   9.48%   17-19, 25-28, 32-36, 45-70, 73-82, 85-90, 94-100, 104-116, 120-126, 129-131, 134-138, 141-162, 165-173, 176, 179-195, 198-200, 203-208, 221-408, 418-514, 519-523, 546-553
src/driada/utils/signals.py                                   82     71     34      0   9.48%   81-98, 155-176, 215-286, 308-315, 334-354
src/driada/network/matrix_utils.py                           203    178     60      0   9.51%   18-31, 35-36, 40-45, 58-96, 100-107, 111-118, 122-124, 129-175, 179-186, 190-195, 199, 207-210, 214-223, 227-234, 238-249, 253-261, 266-270, 274-281, 285-292, 296-303, 307-310, 314-317
src/driada/dim_reduction/mvu.py                               61     53     20      0   9.88%   22-29, 40-109, 122-146
src/driada/experiment/synthetic/manifold_circular.py          73     63     24      0  10.31%   33-45, 68-69, 107-139, 190-237, 285-376
src/driada/network/spectral.py                                30     26      8      0  10.53%   6-8, 24-37, 41-55
src/driada/rsa/integration.py                                 46     38     22      0  11.76%   63-108, 139-141, 188-219
src/driada/utils/neural.py                                    20     17      4      0  12.50%   25-45, 49-54
src/driada/utils/plot.py                                      38     31     18      0  12.50%   56-86, 125-141, 179-195
src/driada/experiment/wavelet_event_detection.py             156    130     40      1  13.78%   9, 39-42, 46-109, 117-164, 168-169, 173-181, 191-209, 213-249, 255-276, 281-289
src/driada/utils/matrix.py                                    24     20      4      0  14.29%   17-45, 50-54
src/driada/dim_reduction/sequences.py                         22     17     12      0  14.71%   67-101
src/driada/experiment/spike_reconstruction.py                 48     39      8      0  16.07%   49-62, 93-126, 160-215
src/driada/network/graph_utils.py                             48     38     12      0  16.67%   9-16, 21-31, 35-38, 42-46, 50-52, 56-78
src/driada/network/quantum.py                                 39     31      8      0  17.02%   7-14, 18-27, 31-33, 37-55
src/driada/dim_reduction/dr_base.py                           82     60     46      0  17.19%   171-193, 201-216, 225-233, 252-298
src/driada/gdrive/gdrive_utils.py                             74     56     30      0  17.31%   25-28, 31, 61-107, 141-200, 204-210
src/driada/dim_reduction/data.py                             116     88     54      3  18.24%   13-18, 37, 44-45, 54, 59-73, 90-95, 112-142, 178-234, 237-242, 245-247, 250-252
src/driada/dim_reduction/neural.py                           132    101     24      1  20.51%   12-16, 22-43, 46-54, 61-82, 85-90, 96-117, 120-127, 133-140, 143-145, 148-150, 156-163, 170-173, 176-190, 194-198, 202-203, 211-212, 215, 218-226
src/driada/utils/gif.py                                       38     27     14      0  21.15%   25-31, 46-55, 81-100
src/driada/experiment/wavelet_ridge.py                        66     50      4      0  22.86%   26-27, 34-56, 60-66, 70, 74-85, 90-102, 106-107
src/driada/experiment/synthetic/experiment_generators.py     276    204    146      9  23.46%   90-93, 110, 118, 127, 134-137, 150-156, 209->214, 262, 364-863
src/driada/information/ksg.py                                 87     58     20      2  28.97%   26-27, 31, 40, 50-68, 79->81, 93-96, 105-141, 145-164
src/driada/utils/output.py                                    16     10      4      0  30.00%   6-8, 10-12, 16-20
src/driada/experiment/neuron.py                              156     94     36      5  34.90%   35-36, 41-44, 49-50, 65->67, 67->69, 70, 77, 90, 101, 104-109, 112-114, 117-126, 129-132, 135-138, 146-153, 157-164, 169-182, 186-199, 203-211, 215-224, 228-251
src/driada/utils/jit.py                                       29     17      4      1  39.39%   17-25, 58-60, 68, 73-78
src/driada/experiment/exp_base.py                            443    223    244     42  45.12%   36, 46-56, 67-69, 99, 102, 105->117, 108-115, 119, 129-141, 182, 185, 192->191, 194, 200-202, 220, 230, 257-260, 265, 273-280, 306-343, 356, 363, 368, 374-380, 422, 436, 444-456, 463-474, 481-495, 510, 513, 525-528, 541, 551-552, 558-561, 570-571, 577, 590, 599-605, 627-646, 668-691, 703-720, 723, 765-766, 773-811, 835-859, 889, 896, 910-911, 915-920, 923, 926, 929-930, 948, 954, 983, 1016-1035, 1039
src/driada/experiment/synthetic/core.py                       40     19     16      3  46.43%   37-47, 75-80, 89, 97, 146-161
src/driada/information/gcmi_jit_utils.py                     207     81     66      8  55.68%   46, 73-79, 104, 106, 122-134, 171-177, 200-259, 287, 299-304, 360->385, 406, 443-456
src/driada/information/entropy_jit.py                         44     17      4      1  58.33%   33-67, 102
src/driada/information/info_base.py                          401    140    186     32  60.82%   42-45, 49, 84, 87-91, 94-95, 98-102, 105-106, 146-159, 201-211, 226-239, 269-271, 283, 287, 301, 306, 311, 317-319, 322-336, 354-369, 377-378, 388, 417-420, 434-436, 442-448, 455-457, 460-463, 493-496, 509-510, 513-518, 533-535, 599-602, 615-644, 646->exit, 667-671, 678, 681->699, 696, 706-709, 715-726, 812, 854->849, 879, 903-906, 948-964
src/driada/utils/data.py                                     156     57     74     14  62.17%   36, 41->40, 47, 74, 76, 97, 99, 121, 125-130, 139-141, 169-171, 175-178, 182-192, 210-232, 244-246, 251-254, 261-264, 287, 290, 324-329
src/driada/intense/disentanglement.py                        148     44     72      7  67.73%   114, 117, 120, 195, 204-265, 379->378, 383
src/driada/information/gcmi.py                               251     45     78     26  75.99%   16-17, 30-35, 59, 126-127, 146, 164->170, 193, 200, 206, 224->232, 256, 258, 264, 270, 298->313, 326-360, 392, 403, 408, 432->441, 460, 462, 464, 466, 473, 478-479, 482-483, 487
src/driada/intense/intense_base.py                           412     75    220     30  78.96%   18-20, 52-55, 61, 68, 70, 72, 120-121, 298, 303, 394, 441-448, 538, 550, 562-570, 592-607, 714, 1067, 1071, 1075, 1094, 1111-1135, 1143, 1260->exit, 1268, 1299, 1301->1304, 1340-1341, 1404, 1417, 1426->1436, 1431-1434
src/driada/intense/pipelines.py                              283     40    164     34  79.42%   200, 208, 212-225, 244-250, 255, 257, 265, 302, 306->312, 314->298, 354->358, 379->383, 416-422, 543->545, 553->558, 626->614, 628->632, 634, 635->614, 648->657, 776->781, 789->799, 849->841, 851->855, 857, 858->841, 871->887, 991, 998->1004, 1063->1062, 1066-1068, 1073-1075, 1088->1103, 1099, 1107->1106
src/driada/experiment/synthetic/mixed_selectivity.py         126     14     70     23  81.12%   48->51, 56, 69, 74, 77, 111->114, 120, 134->118, 189, 200, 285->288, 293, 301, 307->302, 313->341, 315, 324, 325->322, 336, 345, 378->377, 382->374, 403
src/driada/information/entropy.py                             56      6     14      4  85.71%   18-19, 46, 97-99, 131->128, 163->160
src/driada/experiment/synthetic/time_series.py                88      5     32      7  90.00%   74, 78, 93, 150, 186->189, 194, 245->249
src/driada/information/info_utils.py                          41      1      8      1  95.92%   48
src/driada/intense/stats.py                                  105      0     44      2  98.66%   338->344, 370->372
-------------------------------------------------------------------------------------------------------
TOTAL                                                       8303   5532   3314    256  30.71%
Coverage HTML written to dir htmlcov
Coverage XML written to file coverage.xml
Coverage JSON written to file coverage.json
=========================== short test summary info ============================
FAILED tests/unit/intense/test_intense_pipelines_optimized.py::test_compute_cell_feat_significance_with_disentanglement_fast - KeyError: 'total_neuron_pairs'
FAILED tests/unit/intense/test_intense_pipelines_optimized.py::test_disentanglement_minimal - KeyError: 'total_neuron_pairs'
FAILED tests/unit/intense/test_intense_pipelines_optimized.py::test_compute_feat_feat_significance_edge_cases - ValueError: this is not applicable to discrete TimeSeries
FAILED tests/unit/intense/test_intense_pipelines_optimized.py::test_compute_cell_feat_significance_error_paths - AssertionError: Regex pattern did not match.
 Regex: 'Feature .* not found in experiment'
 Input: 'ts_bunch2 cannot be empty'
FAILED tests/unit/intense/test_intense_pipelines_optimized.py::test_cell_cell_with_identical_spike_data - ValueError: MI computation of a TimeSeries or MultiTimeSeries with itself is not allowed
======================== 5 failed, 93 passed in 35.67s =========================

ERROR conda.cli.main_run:execute(125): `conda run python /var/folders/6k/qvnh55652hvfzbwp8wl6fwsr0000gq/T/tmp237d7ryn.py` failed. (See above for error)
