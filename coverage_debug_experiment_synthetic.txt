============================= test session starts ==============================
platform darwin -- Python 3.12.7, pytest-7.4.4, pluggy-1.6.0 -- /opt/anaconda3/bin/python
cachedir: .pytest_cache
rootdir: /Users/nikita/PycharmProjects/driada2
configfile: pytest.ini
plugins: cov-6.2.1, anyio-4.2.0
collecting ... collected 89 items

tests/unit/experiment/synthetic/test_time_series.py::TestBinaryTimeSeries::test_generate_binary_time_series_basic PASSED [  1%]
tests/unit/experiment/synthetic/test_time_series.py::TestBinaryTimeSeries::test_generate_binary_time_series_edge_cases PASSED [  2%]
tests/unit/experiment/synthetic/test_time_series.py::TestBinaryTimeSeries::test_generate_binary_time_series_reproducibility PASSED [  3%]
tests/unit/experiment/synthetic/test_time_series.py::TestBinaryTimeSeries::test_realistic_parameters PASSED [  4%]
tests/unit/experiment/synthetic/test_mixed_selectivity.py::TestMultiselectivityPatterns::test_basic_pattern_generation PASSED [  5%]
tests/unit/experiment/synthetic/test_mixed_selectivity.py::TestMultiselectivityPatterns::test_weight_modes PASSED [  6%]
tests/unit/experiment/synthetic/test_mixed_selectivity.py::TestMultiselectivityPatterns::test_no_selectivity PASSED [  7%]
tests/unit/experiment/synthetic/test_mixed_selectivity.py::TestMixedSelectiveSignal::test_signal_generation_basic PASSED [  8%]
tests/unit/experiment/synthetic/test_mixed_selectivity.py::TestMixedSelectiveSignal::test_signal_with_continuous_features PASSED [ 10%]
tests/unit/experiment/synthetic/test_mixed_selectivity.py::TestSyntheticDataMixedSelectivity::test_data_generation_with_known_selectivity PASSED [ 11%]
tests/unit/experiment/synthetic/test_mixed_selectivity.py::TestGenerateSyntheticExpWithMixedSelectivity::test_basic_generation PASSED [ 12%]
tests/unit/experiment/synthetic/test_mixed_selectivity.py::TestGenerateSyntheticExpWithMixedSelectivity::test_detectability_of_mixed_selectivity FAILED [ 13%]
tests/unit/experiment/synthetic/test_mixed_selectivity.py::TestGenerateSyntheticExpWithMixedSelectivity::test_multifeature_generation PASSED [ 14%]
tests/unit/experiment/synthetic/test_mixed_selectivity.py::TestGenerateSyntheticExpWithMixedSelectivity::test_parameter_sensitivity PASSED [ 15%]
tests/unit/experiment/synthetic/test_mixed_selectivity.py::TestIntegrationWithAnalysisPipeline::test_full_pipeline_with_mixed_selectivity FAILED [ 16%]
tests/unit/experiment/synthetic/test_mixed_selectivity.py::test_generation_performance PASSED [ 17%]
tests/unit/experiment/synthetic/test_mixed_selectivity.py::test_edge_cases PASSED [ 19%]
tests/unit/experiment/synthetic/test_2d_spatial_manifold.py::TestGenerate2DRandomWalk::test_basic_generation PASSED [ 20%]
tests/unit/experiment/synthetic/test_2d_spatial_manifold.py::TestGenerate2DRandomWalk::test_custom_bounds PASSED [ 21%]
tests/unit/experiment/synthetic/test_2d_spatial_manifold.py::TestGenerate2DRandomWalk::test_step_size_effect PASSED [ 22%]
tests/unit/experiment/synthetic/test_2d_spatial_manifold.py::TestGenerate2DRandomWalk::test_momentum_effect PASSED [ 23%]
tests/unit/experiment/synthetic/test_2d_spatial_manifold.py::TestGenerate2DRandomWalk::test_reproducibility PASSED [ 24%]
tests/unit/experiment/synthetic/test_2d_spatial_manifold.py::TestGaussianPlaceField::test_basic_response PASSED [ 25%]
tests/unit/experiment/synthetic/test_2d_spatial_manifold.py::TestGaussianPlaceField::test_sigma_effect PASSED [ 26%]
tests/unit/experiment/synthetic/test_2d_spatial_manifold.py::TestGenerate2DManifoldNeurons::test_basic_generation PASSED [ 28%]
tests/unit/experiment/synthetic/test_2d_spatial_manifold.py::TestGenerate2DManifoldNeurons::test_grid_arrangement PASSED [ 29%]
tests/unit/experiment/synthetic/test_2d_spatial_manifold.py::TestGenerate2DManifoldNeurons::test_random_arrangement PASSED [ 30%]
tests/unit/experiment/synthetic/test_2d_spatial_manifold.py::TestGenerate2DManifoldNeurons::test_firing_rate_modulation PASSED [ 31%]
tests/unit/experiment/synthetic/test_2d_spatial_manifold.py::TestGenerate2DManifoldData::test_basic_generation PASSED [ 32%]
tests/unit/experiment/synthetic/test_2d_spatial_manifold.py::TestGenerate2DManifoldExp::test_return_info_false PASSED [ 33%]
tests/unit/experiment/synthetic/test_2d_spatial_manifold.py::TestGenerate2DManifoldExp::test_return_info_true PASSED [ 34%]
tests/unit/experiment/synthetic/test_2d_spatial_manifold.py::TestGenerate2DManifoldExp::test_basic_experiment PASSED [ 35%]
tests/unit/experiment/synthetic/test_2d_spatial_manifold.py::TestGenerate2DManifoldExp::test_intense_analysis_compatibility FAILED [ 37%]
tests/unit/experiment/synthetic/test_2d_spatial_manifold.py::TestGenerate2DManifoldExp::test_parameter_effects PASSED [ 38%]
tests/unit/experiment/synthetic/test_mixed_population_optimized.py::TestGenerateMixedPopulationExpFast::test_basic_generation_fast PASSED [ 39%]
tests/unit/experiment/synthetic/test_mixed_population_optimized.py::TestGenerateMixedPopulationExpFast::test_different_manifold_types_fast[2d_spatial] PASSED [ 40%]
tests/unit/experiment/synthetic/test_mixed_population_optimized.py::TestGenerateMixedPopulationExpFast::test_different_manifold_types_fast[circular] PASSED [ 41%]
tests/unit/experiment/synthetic/test_mixed_population_optimized.py::TestGenerateMixedPopulationExpFast::test_different_manifold_types_fast[3d_spatial] PASSED [ 42%]
tests/unit/experiment/synthetic/test_mixed_population_optimized.py::TestGenerateMixedPopulationExpFast::test_feature_selective_params_fast PASSED [ 43%]
tests/unit/experiment/synthetic/test_mixed_population_optimized.py::TestGenerateMixedPopulationExpFast::test_correlation_effects_minimal PASSED [ 44%]
tests/unit/experiment/synthetic/test_mixed_population_optimized.py::TestGenerateMixedPopulationExpFast::test_calcium_signal_properties PASSED [ 46%]
tests/unit/experiment/synthetic/test_mixed_population_optimized.py::TestGenerateMixedPopulationExpFast::test_edge_cases PASSED [ 47%]
tests/unit/experiment/synthetic/test_mixed_population_optimized.py::TestGenerateMixedPopulationExpFast::test_feature_configuration PASSED [ 48%]
tests/unit/experiment/synthetic/test_mixed_population_optimized.py::TestParameterValidation::test_invalid_manifold_fraction PASSED [ 49%]
tests/unit/experiment/synthetic/test_mixed_population_optimized.py::TestParameterValidation::test_invalid_manifold_type PASSED [ 50%]
tests/unit/experiment/synthetic/test_mixed_population_optimized.py::TestParameterValidation::test_invalid_neuron_count PASSED [ 51%]
tests/unit/experiment/synthetic/test_mixed_population_optimized.py::TestIntegrationWithINTENSE::test_mixed_population_with_intense_minimal FAILED [ 52%]
tests/unit/experiment/synthetic/test_mixed_population_optimized.py::TestPerformanceBenchmarks::test_generation_under_1s PASSED [ 53%]
tests/unit/experiment/synthetic/test_mixed_population_optimized.py::TestPerformanceBenchmarks::test_multiple_generations_under_5s PASSED [ 55%]
tests/unit/experiment/synthetic/test_circular_manifold.py::test_circular_random_walk_basic PASSED [ 56%]
tests/unit/experiment/synthetic/test_circular_manifold.py::test_circular_random_walk_reproducibility PASSED [ 57%]
tests/unit/experiment/synthetic/test_circular_manifold.py::test_circular_random_walk_step_sizes PASSED [ 58%]
tests/unit/experiment/synthetic/test_circular_manifold.py::test_circular_random_walk_wrapping PASSED [ 59%]
tests/unit/experiment/synthetic/test_circular_manifold.py::test_von_mises_tuning_basic PASSED [ 60%]
tests/unit/experiment/synthetic/test_circular_manifold.py::test_von_mises_circular_symmetry PASSED [ 61%]
tests/unit/experiment/synthetic/test_circular_manifold.py::test_von_mises_kappa_effect PASSED [ 62%]
tests/unit/experiment/synthetic/test_circular_manifold.py::test_generate_circular_manifold_neurons_basic PASSED [ 64%]
tests/unit/experiment/synthetic/test_circular_manifold.py::test_generate_circular_manifold_neurons_coverage PASSED [ 65%]
tests/unit/experiment/synthetic/test_circular_manifold.py::test_generate_circular_manifold_neurons_tuning PASSED [ 66%]
tests/unit/experiment/synthetic/test_circular_manifold.py::test_generate_circular_manifold_neurons_noise PASSED [ 67%]
tests/unit/experiment/synthetic/test_circular_manifold.py::test_generate_circular_manifold_data_basic PASSED [ 68%]
tests/unit/experiment/synthetic/test_circular_manifold.py::test_generate_circular_manifold_data_calcium FAILED [ 69%]
tests/unit/experiment/synthetic/test_circular_manifold.py::test_generate_circular_manifold_exp_basic PASSED [ 70%]
tests/unit/experiment/synthetic/test_circular_manifold.py::test_generate_circular_manifold_exp_extra_features PASSED [ 71%]
tests/unit/experiment/synthetic/test_circular_manifold.py::test_generate_circular_manifold_exp_parameters PASSED [ 73%]
tests/unit/experiment/synthetic/test_circular_manifold.py::test_generate_circular_manifold_exp_reproducibility PASSED [ 74%]
tests/unit/experiment/synthetic/test_circular_manifold.py::test_various_sizes[10-20] PASSED [ 75%]
tests/unit/experiment/synthetic/test_circular_manifold.py::test_various_sizes[100-60] PASSED [ 76%]
tests/unit/experiment/synthetic/test_circular_manifold.py::test_various_sizes[200-30] PASSED [ 77%]
tests/unit/experiment/synthetic/test_circular_manifold.py::test_edge_cases PASSED [ 78%]
tests/unit/experiment/synthetic/test_circular_manifold.py::test_von_mises_edge_cases PASSED [ 79%]
tests/unit/experiment/synthetic/test_circular_manifold.py::test_integration_with_intense FAILED [ 80%]
tests/unit/experiment/synthetic/test_circular_manifold.py::test_linear_vs_circular_detection FAILED [ 82%]
tests/unit/experiment/synthetic/test_3d_spatial_manifold.py::TestGenerate3DRandomWalk::test_basic_generation PASSED [ 83%]
tests/unit/experiment/synthetic/test_3d_spatial_manifold.py::TestGenerate3DRandomWalk::test_custom_bounds PASSED [ 84%]
tests/unit/experiment/synthetic/test_3d_spatial_manifold.py::TestGenerate3DRandomWalk::test_step_size_effect PASSED [ 85%]
tests/unit/experiment/synthetic/test_3d_spatial_manifold.py::TestGenerate3DRandomWalk::test_momentum_effect PASSED [ 86%]
tests/unit/experiment/synthetic/test_3d_spatial_manifold.py::TestGenerate3DRandomWalk::test_reproducibility PASSED [ 87%]
tests/unit/experiment/synthetic/test_3d_spatial_manifold.py::TestGaussianPlaceField3D::test_basic_response PASSED [ 88%]
tests/unit/experiment/synthetic/test_3d_spatial_manifold.py::TestGaussianPlaceField3D::test_sigma_effect PASSED [ 89%]
tests/unit/experiment/synthetic/test_3d_spatial_manifold.py::TestGenerate3DManifoldNeurons::test_basic_generation PASSED [ 91%]
tests/unit/experiment/synthetic/test_3d_spatial_manifold.py::TestGenerate3DManifoldNeurons::test_grid_arrangement PASSED [ 92%]
tests/unit/experiment/synthetic/test_3d_spatial_manifold.py::TestGenerate3DManifoldNeurons::test_random_arrangement PASSED [ 93%]
tests/unit/experiment/synthetic/test_3d_spatial_manifold.py::TestGenerate3DManifoldNeurons::test_firing_rate_modulation PASSED [ 94%]
tests/unit/experiment/synthetic/test_3d_spatial_manifold.py::TestGenerate3DManifoldData::test_basic_generation PASSED [ 95%]
tests/unit/experiment/synthetic/test_3d_spatial_manifold.py::TestGenerate3DManifoldExp::test_basic_experiment PASSED [ 96%]
tests/unit/experiment/synthetic/test_3d_spatial_manifold.py::TestGenerate3DManifoldExp::test_intense_analysis_compatibility FAILED [ 97%]
tests/unit/experiment/synthetic/test_3d_spatial_manifold.py::TestGenerate3DManifoldExp::test_parameter_effects PASSED [ 98%]
tests/unit/experiment/synthetic/test_3d_spatial_manifold.py::TestGenerate3DManifoldExp::test_default_neuron_count PASSED [100%]

=================================== FAILURES ===================================
_ TestGenerateSyntheticExpWithMixedSelectivity.test_detectability_of_mixed_selectivity _
tests/unit/experiment/synthetic/test_mixed_selectivity.py:286: in test_detectability_of_mixed_selectivity
    stats, significance, _, _, disent_results = compute_cell_feat_significance(
src/driada/intense/pipelines.py:282: in compute_cell_feat_significance
    computed_stats, computed_significance, info = compute_me_stats(
src/driada/intense/intense_base.py:1478: in compute_me_stats
    final_stats = add_names_to_nested_dict(merged_stats, names1, names2)
E   NameError: name 'add_names_to_nested_dict' is not defined
----------------------------- Captured stdout call -----------------------------
Building neurons...
Building data hashes...
Final checkpoint...
Experiment "SyntheticMixedSelectivity" constructed successfully with 20 neurons and 4 features
Retrieving saved stats data...
----------------------------- Captured stderr call -----------------------------

  0%|          | 0/20 [00:00<?, ?it/s]
 50%|█████     | 10/20 [00:00<00:00, 98.26it/s]
100%|██████████| 20/20 [00:00<00:00, 72.39it/s]
100%|██████████| 20/20 [00:00<00:00, 75.29it/s]
/Users/nikita/PycharmProjects/driada2/src/driada/experiment/exp_base.py:139: UserWarning: No spike data provided, spikes reconstruction from Ca2+ data disabled
  warnings.warn(

  0%|          | 0/20 [00:00<?, ?it/s]
 15%|█▌        | 3/20 [00:00<00:00, 27.69it/s]
 35%|███▌      | 7/20 [00:00<00:00, 32.67it/s]
 55%|█████▌    | 11/20 [00:00<00:00, 34.44it/s]
 75%|███████▌  | 15/20 [00:00<00:00, 35.35it/s]
 95%|█████████▌| 19/20 [00:00<00:00, 35.69it/s]
100%|██████████| 20/20 [00:00<00:00, 34.73it/s]

  0%|          | 0/5 [00:00<?, ?it/s]
100%|██████████| 5/5 [00:00<00:00, 112.95it/s]

  0%|          | 0/5 [00:00<?, ?it/s]
 60%|██████    | 3/5 [00:00<00:00, 19.37it/s]
100%|██████████| 5/5 [00:00<00:00, 23.48it/s]
_ TestIntegrationWithAnalysisPipeline.test_full_pipeline_with_mixed_selectivity _
tests/unit/experiment/synthetic/test_mixed_selectivity.py:502: in test_full_pipeline_with_mixed_selectivity
    stats, sig, _, results, disent_results = compute_cell_feat_significance(
src/driada/intense/pipelines.py:282: in compute_cell_feat_significance
    computed_stats, computed_significance, info = compute_me_stats(
src/driada/intense/intense_base.py:1478: in compute_me_stats
    final_stats = add_names_to_nested_dict(merged_stats, names1, names2)
E   NameError: name 'add_names_to_nested_dict' is not defined
----------------------------- Captured stdout call -----------------------------
Building neurons...
Building data hashes...
Final checkpoint...
Experiment "SyntheticMixedSelectivity" constructed successfully with 20 neurons and 3 features
Retrieving saved stats data...
----------------------------- Captured stderr call -----------------------------

  0%|          | 0/20 [00:00<?, ?it/s]
 20%|██        | 4/20 [00:00<00:00, 39.40it/s]
 40%|████      | 8/20 [00:00<00:00, 36.29it/s]
 60%|██████    | 12/20 [00:00<00:00, 36.86it/s]
 85%|████████▌ | 17/20 [00:00<00:00, 39.09it/s]
100%|██████████| 20/20 [00:00<00:00, 38.40it/s]
/Users/nikita/PycharmProjects/driada2/src/driada/experiment/exp_base.py:139: UserWarning: No spike data provided, spikes reconstruction from Ca2+ data disabled
  warnings.warn(

  0%|          | 0/20 [00:00<?, ?it/s]
 10%|█         | 2/20 [00:00<00:01, 17.96it/s]
 20%|██        | 4/20 [00:00<00:00, 17.19it/s]
 30%|███       | 6/20 [00:00<00:00, 17.44it/s]
 40%|████      | 8/20 [00:00<00:00, 17.42it/s]
 50%|█████     | 10/20 [00:00<00:00, 17.59it/s]
 60%|██████    | 12/20 [00:00<00:00, 17.68it/s]
 70%|███████   | 14/20 [00:00<00:00, 17.92it/s]
 80%|████████  | 16/20 [00:00<00:00, 17.96it/s]
 90%|█████████ | 18/20 [00:01<00:00, 17.90it/s]
100%|██████████| 20/20 [00:01<00:00, 17.97it/s]
100%|██████████| 20/20 [00:01<00:00, 17.78it/s]

  0%|          | 0/5 [00:00<?, ?it/s]
 80%|████████  | 4/5 [00:00<00:00, 34.91it/s]
100%|██████████| 5/5 [00:00<00:00, 34.94it/s]

  0%|          | 0/5 [00:00<?, ?it/s]
 40%|████      | 2/5 [00:00<00:00, 13.27it/s]
 80%|████████  | 4/5 [00:00<00:00, 13.29it/s]
100%|██████████| 5/5 [00:00<00:00, 13.34it/s]
________ TestGenerate2DManifoldExp.test_intense_analysis_compatibility _________
tests/unit/experiment/synthetic/test_2d_spatial_manifold.py:314: in test_intense_analysis_compatibility
    stats1, significance1, _, _ = compute_cell_feat_significance(
src/driada/intense/pipelines.py:282: in compute_cell_feat_significance
    computed_stats, computed_significance, info = compute_me_stats(
src/driada/intense/intense_base.py:1478: in compute_me_stats
    final_stats = add_names_to_nested_dict(merged_stats, names1, names2)
E   NameError: name 'add_names_to_nested_dict' is not defined
----------------------------- Captured stdout call -----------------------------
Building neurons...
Building data hashes...
Final checkpoint...
Experiment "2d_spatial_manifold_exp" constructed successfully with 9 neurons and 3 features
Downsampling constant is too high: some behaviour acts may be skipped. Current minimal behaviour time interval is set to 0.25 sec, downsampling 5 will create time gaps of 0.5 sec
Retrieving saved stats data...
----------------------------- Captured stderr call -----------------------------
/opt/anaconda3/lib/python3.12/site-packages/ssqueezepy/_gmw.py:219: RuntimeWarning: divide by zero encountered in log
  + beta * np.log(w) - w**gamma) * w_nonneg

  0%|          | 0/9 [00:00<?, ?it/s]
100%|██████████| 9/9 [00:00<00:00, 94.86it/s]

  0%|          | 0/9 [00:00<?, ?it/s]
100%|██████████| 9/9 [00:00<00:00, 254.95it/s]

  0%|          | 0/9 [00:00<?, ?it/s]
100%|██████████| 9/9 [00:00<00:00, 178.87it/s]

  0%|          | 0/9 [00:00<?, ?it/s]
100%|██████████| 9/9 [00:00<00:00, 307.74it/s]

  0%|          | 0/9 [00:00<?, ?it/s]
100%|██████████| 9/9 [00:00<00:00, 176.41it/s]
____ TestIntegrationWithINTENSE.test_mixed_population_with_intense_minimal _____
tests/unit/experiment/synthetic/test_mixed_population_optimized.py:239: in test_mixed_population_with_intense_minimal
    result = compute_cell_feat_significance(
src/driada/intense/pipelines.py:282: in compute_cell_feat_significance
    computed_stats, computed_significance, info = compute_me_stats(
src/driada/intense/intense_base.py:1359: in compute_me_stats
    final_stats = add_names_to_nested_dict(stage_1_stats, names1, names2)
E   NameError: name 'add_names_to_nested_dict' is not defined
----------------------------- Captured stdout call -----------------------------
Using pregenerated features...
Generating signals...
Using pregenerated features...
Generating signals...
Building neurons...
Building data hashes...
Final checkpoint...
Experiment "MixedPopulation" constructed successfully with 5 neurons and 9 features
Downsampling constant is too high: some behaviour acts may be skipped. Current minimal behaviour time interval is set to 0.25 sec, downsampling 5 will create time gaps of 0.5 sec
Retrieving saved stats data...
----------------------------- Captured stderr call -----------------------------

  0%|          | 0/1 [00:00<?, ?it/s]
100%|██████████| 1/1 [00:00<00:00, 985.04it/s]

  0%|          | 0/2 [00:00<?, ?it/s]
100%|██████████| 2/2 [00:00<00:00, 872.99it/s]
/Users/nikita/PycharmProjects/driada2/src/driada/experiment/exp_base.py:139: UserWarning: No spike data provided, spikes reconstruction from Ca2+ data disabled
  warnings.warn(

  0%|          | 0/5 [00:00<?, ?it/s]
100%|██████████| 5/5 [00:00<00:00, 300.78it/s]
[Parallel(n_jobs=3)]: Using backend ThreadingBackend with 3 concurrent workers.
[Parallel(n_jobs=3)]: Done   3 out of   3 | elapsed:    0.0s finished
_________________ test_generate_circular_manifold_data_calcium _________________
tests/unit/experiment/synthetic/test_circular_manifold.py:257: in test_generate_circular_manifold_data_calcium
    stats, significance, info_intense, results = compute_cell_feat_significance(
src/driada/intense/pipelines.py:282: in compute_cell_feat_significance
    computed_stats, computed_significance, info = compute_me_stats(
src/driada/intense/intense_base.py:1478: in compute_me_stats
    final_stats = add_names_to_nested_dict(merged_stats, names1, names2)
E   NameError: name 'add_names_to_nested_dict' is not defined
----------------------------- Captured stdout call -----------------------------
Building neurons...
Building data hashes...
Final checkpoint...
Experiment "circular_manifold_exp" constructed successfully with 10 neurons and 2 features
Downsampling constant is too high: some behaviour acts may be skipped. Current minimal behaviour time interval is set to 0.25 sec, downsampling 5 will create time gaps of 0.5 sec
Retrieving saved stats data...
----------------------------- Captured stderr call -----------------------------
/opt/anaconda3/lib/python3.12/site-packages/ssqueezepy/_gmw.py:219: RuntimeWarning: divide by zero encountered in log
  + beta * np.log(w) - w**gamma) * w_nonneg

  0%|          | 0/10 [00:00<?, ?it/s]
100%|██████████| 10/10 [00:00<00:00, 157.99it/s]

  0%|          | 0/10 [00:00<?, ?it/s]
100%|██████████| 10/10 [00:00<00:00, 388.38it/s]

  0%|          | 0/10 [00:00<?, ?it/s]
100%|██████████| 10/10 [00:00<00:00, 588.58it/s]

  0%|          | 0/10 [00:00<?, ?it/s]
100%|██████████| 10/10 [00:00<00:00, 656.60it/s]
________________________ test_integration_with_intense _________________________
tests/unit/experiment/synthetic/test_circular_manifold.py:509: in test_integration_with_intense
    stats, significance, _, _ = compute_cell_feat_significance(
src/driada/intense/pipelines.py:282: in compute_cell_feat_significance
    computed_stats, computed_significance, info = compute_me_stats(
src/driada/intense/intense_base.py:1478: in compute_me_stats
    final_stats = add_names_to_nested_dict(merged_stats, names1, names2)
E   NameError: name 'add_names_to_nested_dict' is not defined
----------------------------- Captured stdout call -----------------------------
Building neurons...
Building data hashes...
Final checkpoint...
Experiment "circular_manifold_exp" constructed successfully with 10 neurons and 1 features
Downsampling constant is too high: some behaviour acts may be skipped. Current minimal behaviour time interval is set to 0.25 sec, downsampling 5 will create time gaps of 0.5 sec
Retrieving saved stats data...
----------------------------- Captured stderr call -----------------------------
/opt/anaconda3/lib/python3.12/site-packages/ssqueezepy/_gmw.py:219: RuntimeWarning: divide by zero encountered in log
  + beta * np.log(w) - w**gamma) * w_nonneg

  0%|          | 0/10 [00:00<?, ?it/s]
100%|██████████| 10/10 [00:00<00:00, 95.19it/s]
100%|██████████| 10/10 [00:00<00:00, 95.02it/s]

  0%|          | 0/10 [00:00<?, ?it/s]
100%|██████████| 10/10 [00:00<00:00, 252.84it/s]

  0%|          | 0/10 [00:00<?, ?it/s]
100%|██████████| 10/10 [00:00<00:00, 605.18it/s]

  0%|          | 0/10 [00:00<?, ?it/s]
100%|██████████| 10/10 [00:00<00:00, 675.80it/s]
______________________ test_linear_vs_circular_detection _______________________
tests/unit/experiment/synthetic/test_circular_manifold.py:557: in test_linear_vs_circular_detection
    stats1, significance1, info1, results1 = compute_cell_feat_significance(
src/driada/intense/pipelines.py:282: in compute_cell_feat_significance
    computed_stats, computed_significance, info = compute_me_stats(
src/driada/intense/intense_base.py:1478: in compute_me_stats
    final_stats = add_names_to_nested_dict(merged_stats, names1, names2)
E   NameError: name 'add_names_to_nested_dict' is not defined
----------------------------- Captured stdout call -----------------------------
Building neurons...
Building data hashes...
Final checkpoint...
Experiment "circular_manifold_exp" constructed successfully with 10 neurons and 2 features
Downsampling constant is too high: some behaviour acts may be skipped. Current minimal behaviour time interval is set to 0.25 sec, downsampling 5 will create time gaps of 0.5 sec
Retrieving saved stats data...
----------------------------- Captured stderr call -----------------------------
/opt/anaconda3/lib/python3.12/site-packages/ssqueezepy/_gmw.py:219: RuntimeWarning: divide by zero encountered in log
  + beta * np.log(w) - w**gamma) * w_nonneg

  0%|          | 0/10 [00:00<?, ?it/s]
100%|██████████| 10/10 [00:00<00:00, 96.05it/s]
100%|██████████| 10/10 [00:00<00:00, 95.88it/s]

  0%|          | 0/10 [00:00<?, ?it/s]
100%|██████████| 10/10 [00:00<00:00, 255.49it/s]

  0%|          | 0/10 [00:00<?, ?it/s]
100%|██████████| 10/10 [00:00<00:00, 359.82it/s]

  0%|          | 0/10 [00:00<?, ?it/s]
100%|██████████| 10/10 [00:00<00:00, 617.59it/s]

  0%|          | 0/10 [00:00<?, ?it/s]
100%|██████████| 10/10 [00:00<00:00, 342.83it/s]
________ TestGenerate3DManifoldExp.test_intense_analysis_compatibility _________
tests/unit/experiment/synthetic/test_3d_spatial_manifold.py:296: in test_intense_analysis_compatibility
    stats1, significance1, _, _ = compute_cell_feat_significance(
src/driada/intense/pipelines.py:282: in compute_cell_feat_significance
    computed_stats, computed_significance, info = compute_me_stats(
src/driada/intense/intense_base.py:1478: in compute_me_stats
    final_stats = add_names_to_nested_dict(merged_stats, names1, names2)
E   NameError: name 'add_names_to_nested_dict' is not defined
----------------------------- Captured stdout call -----------------------------
Building neurons...
Building data hashes...
Final checkpoint...
Experiment "3d_spatial_manifold_exp" constructed successfully with 8 neurons and 4 features
Downsampling constant is too high: some behaviour acts may be skipped. Current minimal behaviour time interval is set to 0.25 sec, downsampling 5 will create time gaps of 0.5 sec
Retrieving saved stats data...
----------------------------- Captured stderr call -----------------------------
/opt/anaconda3/lib/python3.12/site-packages/ssqueezepy/_gmw.py:219: RuntimeWarning: divide by zero encountered in log
  + beta * np.log(w) - w**gamma) * w_nonneg

  0%|          | 0/8 [00:00<?, ?it/s]
100%|██████████| 8/8 [00:00<00:00, 92.55it/s]

  0%|          | 0/8 [00:00<?, ?it/s]
100%|██████████| 8/8 [00:00<00:00, 252.68it/s]

  0%|          | 0/8 [00:00<?, ?it/s]
100%|██████████| 8/8 [00:00<00:00, 120.28it/s]

  0%|          | 0/8 [00:00<?, ?it/s]
100%|██████████| 8/8 [00:00<00:00, 206.60it/s]

  0%|          | 0/8 [00:00<?, ?it/s]
100%|██████████| 8/8 [00:00<00:00, 73.28it/s]
100%|██████████| 8/8 [00:00<00:00, 73.17it/s]
================================ tests coverage ================================
_______________ coverage: platform darwin, python 3.12.7-final-0 _______________

Name                                                       Stmts   Miss Branch BrPart   Cover   Missing
-------------------------------------------------------------------------------------------------------
src/driada/dimensionality/effective.py                        26     26     12      0   0.00%   1-47
src/driada/dimensionality/intrinsic.py                       119    119     48      0   0.00%   8-403
src/driada/dimensionality/linear.py                           54     54     16      0   0.00%   8-218
src/driada/dimensionality/utils.py                            42     42      8      0   0.00%   1-91
src/driada/gdrive/auth.py                                     13     13      0      0   0.00%   1-19
src/driada/gdrive/upload.py                                   37     37     10      0   0.00%   1-69
src/driada/integration/selectivity_mapper.py                 123    123     60      0   0.00%   8-428
src/driada/utils/visual.py                                   283    271    134      0   2.88%   63-270, 304-405, 448-546, 591-681, 718-778, 811-858
src/driada/intense/disentanglement.py                        148    140     72      0   3.64%   59-122, 183-280, 304-319, 348-406
src/driada/intense/visual.py                                 236    224     70      0   3.92%   30-66, 112-174, 218-292, 364-424, 466-549, 605-754
src/driada/network/randomization.py                          311    293     94      0   4.44%   40-50, 94-250, 286-339, 371-412, 431-444, 471-640, 709-737
src/driada/utils/naming.py                                    13     12      6      0   5.26%   2-27
src/driada/rsa/core.py                                       164    149     84      0   6.05%   43-80, 112-140, 176-231, 253-279, 324-364, 438-505, 566-618
src/driada/rsa/core_jit.py                                    95     85     58      0   6.54%   26-106, 128-142, 160-173, 191-203
src/driada/dim_reduction/manifold_metrics.py                 311    284     98      0   6.60%   39-43, 77-102, 126-160, 184-218, 249-280, 302-312, 335-385, 412-445, 476-503, 524-525, 541-543, 559-568, 600-637, 658-679, 717-767, 793-814, 851-886, 908-948, 982-1012, 1046-1074, 1108-1153
src/driada/rsa/visual.py                                      78     71     28      0   6.60%   53-155, 186-224
src/driada/utils/spatial.py                                  213    194     74      0   6.62%   60-93, 129-162, 195-232, 256-274, 300-336, 380-421, 450-494, 522-548, 576-603, 652-725, 754-780
src/driada/experiment/exp_build.py                           119    105     72      0   7.33%   26-143, 164-233, 237-240, 244-250
src/driada/dim_reduction/graph.py                            232    208     72      0   7.89%   26-74, 81-94, 97-98, 101-113, 118-136, 139-197, 200-212, 216-271, 275-374, 379-386, 449-535
src/driada/network/net_base.py                               385    340    172      0   8.08%   21-33, 40-41, 45-49, 53-65, 73-92, 114-174, 180-228, 235-301, 304-305, 309-341, 345-368, 371-384, 387-406, 409-415, 418-424, 427-433, 436-442, 460-533, 538-567, 570-582, 586-599, 602-604, 607-609, 612-614, 617-619, 622-626, 629-639, 642-670
src/driada/dim_reduction/embedding.py                        313    280     74      0   8.53%   18-20, 27-30, 34-38, 47-72, 75-87, 90-95, 99-106, 110-124, 127-148, 151-153, 156-160, 163-184, 187-202, 218-285, 293-311, 314-316, 319-325, 351-569, 593-713, 718-722, 745-752
src/driada/network/drawing.py                                133    117     54      0   8.56%   13-58, 62-73, 77-80, 93-149, 153-177, 181-194, 199-224
src/driada/gdrive/download.py                                102     89     46      0   8.78%   22-71, 86-130, 143-204, 208-233
src/driada/utils/signals.py                                   82     71     34      0   9.48%   81-98, 156-177, 218-289, 313-320, 339-359
src/driada/network/matrix_utils.py                           203    178     60      0   9.51%   18-31, 35-36, 40-45, 58-96, 100-107, 111-118, 122-124, 129-175, 179-186, 190-195, 199, 207-210, 214-225, 229-236, 240-251, 255-263, 268-272, 276-283, 287-296, 300-307, 311-314, 318-321
src/driada/information/time_series_types.py                  231    198    116      0   9.51%   35, 39, 43, 47, 78-133, 152-219, 226-259, 266-348, 356-449, 461-487, 498-502, 514-536, 559-563
src/driada/network/spectral.py                                30     26      8      0  10.53%   6-8, 24-37, 41-55
src/driada/utils/plot.py                                      37     31     18      0  10.91%   55-80, 119-135, 173-186
src/driada/dim_reduction/mvu.py                               68     58     22      0  11.11%   8-10, 37-50, 61-146, 158-184
src/driada/rsa/integration.py                                 46     38     22      0  11.76%   62-113, 146-148, 195-233
src/driada/information/entropy_jit.py                         44     38      4      0  12.50%   32-66, 85-128
src/driada/utils/neural.py                                    20     17      4      0  12.50%   22-46, 52-59
src/driada/intense/pipelines.py                              287    244    170      9  13.57%   200-203, 213, 219, 224-234, 241->244, 244->272, 255-263, 268, 270, 280, 312-467, 577-701, 812-938, 1038-1173
src/driada/utils/matrix.py                                    24     20      4      0  14.29%   17-45, 50-54
src/driada/dim_reduction/sequences.py                         22     17     12      0  14.71%   67-101
src/driada/information/ksg.py                                 87     71     20      0  14.95%   18, 23, 27-30, 34, 42-45, 53-71, 81-89, 96-99, 117-157, 161-180
src/driada/dim_reduction/dr_base.py                           82     61     46      0  16.41%   191-215, 223-238, 247-256, 277-339
src/driada/gdrive/gdrive_utils.py                             73     56     30      0  16.50%   25-28, 31, 61-105, 135-194, 198-204
src/driada/network/graph_utils.py                             48     38     12      0  16.67%   10-19, 24-36, 40-43, 47-51, 55-57, 61-83
src/driada/network/quantum.py                                 39     31      8      0  17.02%   8-27, 31-40, 44-46, 50-68
src/driada/dim_reduction/data.py                             116     88     54      3  18.24%   13-18, 39, 46-47, 56, 61-75, 92-97, 114-146, 189-267, 270-275, 278-280, 283-285
src/driada/utils/gif.py                                       37     27     14      0  19.61%   23-31, 46-55, 83-110
src/driada/information/entropy.py                             55     41     14      0  20.29%   18-19, 42-52, 68, 89-101, 125-139, 161-173, 198-201, 224-227
src/driada/dim_reduction/neural.py                           131    100     24      1  20.65%   12-15, 21-42, 45-55, 62-83, 86-93, 99-120, 123-132, 138-157, 160-162, 165-167, 181-200, 207-210, 213-227, 231-235, 239-240, 248-249, 252, 255-263
src/driada/information/gcmi_jit_utils.py                     206    157     66      3  22.79%   72-78, 103, 105, 127-143, 182-188, 211-270, 297-397, 416-432, 454-467
src/driada/utils/data.py                                     155    107     74      4  26.20%   34-52, 72, 74, 90-106, 112-141, 145-147, 175-177, 181-184, 188-198, 216-238, 250-252, 264-267, 274-277, 289-306, 320-351
src/driada/utils/output.py                                    16     10      4      0  30.00%   7-9, 12-14, 18-22
src/driada/information/info_base.py                          439    273    204     28  33.90%   35-62, 66, 70-105, 149-157, 160-168, 184-194, 224, 227-231, 234-235, 238-242, 245-246, 249-251, 254-263, 286-304, 347-359, 383-403, 443-445, 459, 465, 481, 486, 491, 499-501, 504-523, 541-563, 574-577, 582-589, 619-622, 642-688, 720-723, 740-743, 746-751, 763-787, 804, 810, 856-859, 871, 878-911, 913->exit, 921-938, 941-946, 948->966, 954->956, 963, 973-978, 984-995, 1031, 1082-1188, 1227-1243
src/driada/utils/jit.py                                       27     17      4      1  35.48%   20-30, 63-66, 74, 79-85
src/driada/experiment/neuron.py                              156     93     36      2  36.98%   36-37, 41-44, 49-50, 77, 99, 110, 113-118, 121-123, 126-135, 138-141, 144-147, 154-167, 170-177, 181-194, 197-210, 213-221, 224-233, 236-262
src/driada/information/gcmi.py                               250    143     78     12  38.11%   21-22, 32-47, 65-70, 132-133, 150-181, 204, 213, 219, 237->245, 269, 271, 277, 283, 311->326, 339-377, 397-464, 479-530
src/driada/experiment/exp_base.py                            441    246    244     32  38.98%   58, 68-78, 89-92, 133, 138->156, 144, 158, 167-184, 243, 246, 253->252, 255, 263-267, 297, 331, 336, 344-351, 381-424, 439, 446, 453, 461-472, 492, 505, 516, 524->522, 527-530, 540-552, 559-573, 580-597, 612, 615, 629-634, 643-651, 670-683, 695-703, 718, 727-733, 757-780, 804-833, 847-866, 871, 903-961, 999, 1035-1061, 1067-1068, 1071-1076, 1079, 1082, 1085-1086, 1108-1120, 1143-1151, 1185-1207, 1211
src/driada/experiment/spike_reconstruction.py                 48     25      8      2  44.64%   53, 58-62, 154-206
src/driada/information/info_utils.py                          41     23      8      0  44.90%   43-71, 75-99
src/driada/intense/intense_base.py                           410    186    220     44  50.48%   17-19, 41, 43, 51-56, 59-64, 77, 81, 85, 116-140, 168, 171, 174, 177, 245, 321-353, 430-510, 590, 595, 614, 617, 626-636, 664-685, 797, 804->808, 809-811, 974, 978, 982-983, 987-988, 1165, 1171, 1177, 1196, 1202, 1204, 1209-1210, 1215-1239, 1249, 1270, 1277->1358, 1280, 1321, 1353-1354, 1360-1364, 1368-1374, 1377->exit, 1389, 1426, 1468-1469, 1479-1482, 1535-1538, 1553-1570
src/driada/experiment/synthetic/experiment_generators.py     276     89    146     32  61.37%   112-133, 143, 152, 161->170, 166, 181->194, 186-191, 254-338, 433->437, 452, 455, 467-470, 473->483, 483->495, 504, 583->623, 628->664, 630, 648->638, 660->652, 665-690, 694->760, 697, 706->710, 727->733, 740, 762, 779-784, 791-816, 945-972, 1030-1032
src/driada/experiment/synthetic/core.py                       39     13     16      3  63.64%   44->46, 75-80, 101, 154-171
src/driada/experiment/wavelet_event_detection.py             154     42     40      1  69.59%   8, 37-40, 46-123
src/driada/experiment/synthetic/utils.py                       7      1      4      1  81.82%   31
src/driada/intense/stats.py                                  104     18     44      8  82.43%   23-24, 43-45, 64-66, 90-91, 120, 151-154, 180, 216, 318, 345->351, 376->374, 377->379, 379->374
src/driada/experiment/synthetic/manifold_circular.py          73      6     24      6  87.63%   210, 214, 219, 232, 253, 402
src/driada/experiment/synthetic/mixed_selectivity.py         141     10     80     17  87.78%   56->59, 77, 128->131, 141, 247, 361->364, 369, 384, 390->385, 398, 407, 408->405, 419, 428, 470->469, 477->466, 500
src/driada/experiment/synthetic/manifold_spatial_2d.py        98      5     40      9  89.86%   39->42, 144->147, 157->165, 260->263, 266, 270, 275, 290, 311
src/driada/experiment/synthetic/manifold_spatial_3d.py       108      5     46      9  90.91%   39->42, 154->157, 168->179, 275->278, 281, 285, 290, 305, 326
src/driada/experiment/synthetic/time_series.py                79      1     24      3  96.12%   138, 174->177, 247->251
src/driada/experiment/wavelet_ridge.py                        66      1      4      1  97.14%   65
-------------------------------------------------------------------------------------------------------
TOTAL                                                       8646   6196   3472    231  25.29%
Coverage HTML written to dir htmlcov
Coverage XML written to file coverage.xml
Coverage JSON written to file coverage.json
=========================== short test summary info ============================
FAILED tests/unit/experiment/synthetic/test_mixed_selectivity.py::TestGenerateSyntheticExpWithMixedSelectivity::test_detectability_of_mixed_selectivity
FAILED tests/unit/experiment/synthetic/test_mixed_selectivity.py::TestIntegrationWithAnalysisPipeline::test_full_pipeline_with_mixed_selectivity
FAILED tests/unit/experiment/synthetic/test_2d_spatial_manifold.py::TestGenerate2DManifoldExp::test_intense_analysis_compatibility
FAILED tests/unit/experiment/synthetic/test_mixed_population_optimized.py::TestIntegrationWithINTENSE::test_mixed_population_with_intense_minimal
FAILED tests/unit/experiment/synthetic/test_circular_manifold.py::test_generate_circular_manifold_data_calcium
FAILED tests/unit/experiment/synthetic/test_circular_manifold.py::test_integration_with_intense
FAILED tests/unit/experiment/synthetic/test_circular_manifold.py::test_linear_vs_circular_detection
FAILED tests/unit/experiment/synthetic/test_3d_spatial_manifold.py::TestGenerate3DManifoldExp::test_intense_analysis_compatibility
======================== 8 failed, 81 passed in 37.98s =========================
